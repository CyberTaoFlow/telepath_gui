$(document).ready(function(){telepath.main.init();$(document).click(function(a){$(".tele-popup").each(function(){$(this).hasClass("hook")?0==$(a.target).parents(".tele-popup").size()&&0<$(a.target).parents("body").size()&&$(".tele-popup").remove():$(this).addClass("hook")})})});telepath.loader='<img class="loader" src="img/loader.gif">';telepath.data={};telepath.appFilter=[{key:-1,label:"All Applications"}];
telepath.main={loadResources:function(a){yepnope({load:"css/widgets.css js/widgets/teleAppSelect.js js/widgets/teleInput.js js/widgets/telePassword.js js/widgets/teleCheckbox.js js/widgets/teleList.js js/widgets/teleForm.js js/widgets/teleTree.js js/widgets/teleRule.js js/widgets/teleRadios.js js/widgets/teleBrowse.js js/widgets/teleBrowser.js js/widgets/teleSelect.js js/widgets/teleMulti.js js/widgets/teleRange.js js/widgets/teleFile.js js/widgets/teleSearch.js js/widgets/teleRequest.js js/widgets/teleCountry.js js/lib/jquery.dropdown.js css/jquery.dropdown.css js/lib/bootstrap.min.js css/bootstrap.css js/lib/jquery.pnotify.min.js js/lib/jquery.mousewheel.js js/lib/jquery.mCustomScrollbar.js css/jquery.mCustomScrollbar.css js/lib/jquery.vmap.min.js js/lib/jquery.vmap.world.js js/lib/jquery.vmap.sampledata.js css/jqvmap.css css/config.css js/lib/jquery.weekcalendar.js css/jquery.weekcalendar.css js/lib/jstree.min.js js/lib/jstreegrid.js css/tree.css js/telepath.sessionflow.js?1 js/telepath.handlers.js js/telepath.rule.js js/telepath.dialog.js js/telepath.ipaddress.js js/telepath.condition.js js/telepath.condition.select.js js/telepath.contextmenu.js js/telepath.logmode.js js/telepath.config.account.js js/telepath.config.accounts.js js/telepath.config.action.js js/telepath.config.actions.js js/telepath.config.application.js? js/telepath.config.applications.js js/telepath.config.notifications.js js/telepath.config.rule.js js/telepath.config.rules.js js/telepath.config.user.js js/telepath.config.users.js js/telepath.config.groups.js js/telepath.config.system.js".split(" "),complete:function(){a()}})},
init:function(){telepath.ds.get("/parameters/get_global_headers",{},function(a){telepath.global_headers=a.items});telepath.ds.get("/rules/get_cmds",{},function(a){telepath.rule_cmds=a.items});telepath.ds.get("/telepath/get_app_filter",{},function(a){telepath.app_filter=a.items});telepath.ds.get("/telepath/get_time_range",{},function(a){telepath.range=a.items;telepath.main.loadResources(function(){$.getJSON(telepath.controllerPath+"/telepath/templates",function(a){telepath.templates=a;telepath.ui.init();
telepath.header.init();telepath.dashboard.init();$(".tele-nav-dashboard a").addClass("active")})})});telepath.ds.get("/telepath/get_full_time_range",{},function(a){telepath.fullRangeStart=a.items.start})}};
telepath.ui={init:function(){$(window).resize(function(){telepath.ui.resize()});$(window).click(function(a){0<$(".popover").size()&&!(0<$(a.target).parents(".popover").size()||$(a.target).hasClass("popover"))&&$(".popover").remove()});var a=this;this.mainEl=$("<div>").addClass("tele-body");this.headerEl=$("<div>").addClass("tele-header");this.contentEl=$("<div>").addClass("tele-content");this.mainEl.append(this.headerEl).append(this.contentEl);$("body").append(this.mainEl);this.panels="dashboard cases alerts suspects reports config search".split(" ");
$.each(this.panels,function(b,c){var d=$("<div>").addClass("tele-panel").addClass("tele-panel-"+c);a.contentEl.append(d)});$(".tele-panel-dashboard").addClass("active");$(window).resize(function(){telepath.ui.resize()});telepath.ui.resize()},resize:function(){var a=$(".tele-panel.active");$.each(this.panels,function(b,c){if($(a).hasClass("tele-panel-"+c))return a=c,!1});$(".tele-body").height($(window).height());"dashboard"==a?($(".tele-content").css({height:"890px"}),$("body").css({overflow:"scroll-x"})):
$(".tele-content").css({height:$(window).height()-$(".tele-header").height()-50})}};
telepath.header={getSearchOpts:function(){},init:function(){var a=this;this.logo='<div class="tele-logo"><img src="img/logo.png" alt="Hybrid Security Telepath" /></div>';this.nav=$("<ul>").addClass("tele-nav");this.navItems=[{id:"dashboard",label:"Dashboard"},{id:"cases",label:"Cases"},{id:"alerts",label:"Alerts"},{id:"suspects",label:"Suspects"}];$.each(this.navItems,function(b,c){if(telepath.access.admin||telepath.access.perm[c.label+"_get"])var d=$("<li>").addClass("tele-nav-"+c.id).append($("<a>").attr("href",
"#").append('<span class="tele-nav-icon">').append(c.label));$(a.nav).append(d)});this.headerRight=$("<div>").addClass("tele-header-right");this.search=$("<div>").addClass("tele-search-top");this.searchInput=$("<input>").addClass("tele-search-input");this.searchIcon=$('<a href="#">').addClass("tele-search-icon").html("Search");this.searchDD=$('<a href="#">').addClass("tele-search-dropdown").html("");this.search.append(this.searchInput).append(this.searchIcon).append(this.searchDD);this.headerRight.append(this.search);
$(this.searchIcon).click(function(a){telepath.search.init(telepath.header.searchInput.val());telepath.ui.resize()});$(this.searchInput).keydown(function(a){13==a.keyCode&&(telepath.search.init(telepath.header.searchInput.val()),telepath.ui.resize())});this.searchDD.click(function(){if(0<$(".tele-search-filters").size())$(".tele-search-filters").remove();else{a.searchWrap=$("<div>").addClass("tele-search-filters").addClass("tele-popup");var b=$("<div>").addClass("tele-title-1").html("What to search");
a.searchWrap.append(b);a.headerRight.append(a.searchWrap);telepath.search.printTypes(a.searchWrap)}});$(".tele-header").append(this.logo).append(this.nav).append(this.headerRight);telepath.header.bindHooks();$(window).resize(function(){telepath.header.resize()});telepath.header.resize();this.notifications=$("<div>").notifications();this.configDiv=$("<div>").addClass("tele-config");this.configCmd=$("<a>").attr("href","#").addClass("tele-icon").addClass("tele-icon-config");this.configDiv.append(this.configCmd);
this.configCmd.click(function(){$(".tele-panel").empty().hide();$("#file-upload").hide();$(".tele-nav a.active").removeClass("active");telepath.config.init();$(".tele-panel-config").show();$(this).addClass("active")}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});this.logoutCmd=$("<a>").attr("href","#").addClass("tele-icon").addClass("tele-icon-logout").click(function(){telepath.ds.get("/auth/logout",{},function(a){location.reload(!0)},"Error logging out.")}).hover(function(){$(this).addClass("hover")},
function(){$(this).removeClass("hover")});$(".tele-header-right").append(this.notifications).append(this.configDiv).append(this.logoutCmd)},bindHooks:function(){$(".tele-nav a").click(function(){var a=$(this).parent().attr("class").split("-");if("tele"==a[0]&&"nav"==a[1]&&""!=a[2])a=a[2];else return!1;"dashboard"==a&&telepath.dashboard.loading||($(".tele-panel").empty().hide().removeClass("active"),$("#file-upload").hide(),$(".tele-panel-"+a).show().addClass("active"),telepath.ui.resize(),telepath[a].init(),
telepath.header.configCmd.removeClass("active"),$(".tele-nav a.active").removeClass("active"),$(this).addClass("active"),setTimeout(function(){$(".tele-popup, .popover").remove()},100))})},resize:function(){var a=$(window).width();$(".tele-logo").css({width:200,overflow:"hidden"});1300>a?($(this.searchInput).css({width:100}),1200>a?(1E3>a?($(".tele-logo").css({width:65,overflow:"hidden"}),$(".tele-nav li").css({margin:"0px 0px"})):$(".tele-nav li").css({margin:"0px 10px"}),$(".tele-logo").css({width:65})):
$(".tele-nav li").css({margin:"0px 25px"})):($(this.search).css({input:"{padding: 5px 75px 5px 20px}"}),$(this.searchInput).css({width:140}),$(".tele-nav li").css({margin:"0px 25px"}));var b=(a-$(".tele-header-right").width()-$(".tele-logo").width()-$(".tele-nav").width())/2;$(".tele-nav").css("marginLeft",b);801>a&&($(".tele-nav").css("marginLeft",20),$(".tele-panel-subtitle").css("height","100px !important"),$(".tele-panel-title").css("position","absolute"))}};
function RangeRemove(a){numRanges=$(a).parent().parent().children(".tele-ip-wrap").length;1<numRanges&&$(a).parent().remove()}function RangeRemoveLB(a){numRanges=$(a).parent().parent().children(".tele-ip-wrap-lb").length;1<numRanges&&$(a).parent().remove()}
function old_getRangeUI(a){a=a?a.trim():"";var b=1<a.split("-").length,c=$("<div>").addClass("tele-ip-wrap"),d=$("<div>").addClass("tele-ip").ip({data:a.split("-")[0]}),e=$("<div>").addClass("tele-ip-dash").html("_"),f=$("<div>").addClass("tele-ip").ip({data:b?a.split("-")[1]:""});b||(e.hide(),f.hide());a=$("<div>").addClass("tele-ip-add").addClass("tele-icon").addClass("tele-icon-plus").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){that.limitRanges.append(getRangeUI())});
var g=$("<div>").addClass("tele-ip-remove").addClass("tele-icon").addClass("tele-icon-minus").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){$(this).parent().remove()}),b=$("<div>").toggleFlip({left_value:"Single",right_value:"Range",flip:function(){f.toggle();e.toggle()},flipped:b});c.append(a).append(g).append(b).append(d).append(e).append(f);return c}
function getRangeUI(a,b){a||(a="");var c=a.from!=a.to,d=$("<div>").addClass("tele-ip-wrap"),e=$("<div>").addClass("tele-ip").ip({data:a.from}),f=$("<div>").addClass("tele-ip-dash").html("_"),g=$("<div>").addClass("tele-ip").ip({data:c?a.to:""});c||(f.hide(),g.hide());var h=$("<div>").addClass("tele-ip-add").addClass("tele-icon").addClass("tele-icon-plus").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){b.append(getRangeUI())}),k=$("<div>").addClass("tele-ip-remove").addClass("tele-icon").addClass("tele-icon-minus").hover(function(){$(this).addClass("hover")},
function(){$(this).removeClass("hover")}).click(function(){RangeRemove(this)}),c=$("<div>").toggleFlip({left_value:"Single",right_value:"Range",flip:function(){g.toggle();f.toggle()},flipped:c});d.append(h).append(k).append(c).append(e).append(f).append(g);return d}
function getStatusCodeRangeUI(a){a=a?a.trim():"";var b=1<a.split("-").length,c=$("<div>").addClass("tele-sc-wrap"),d=$("<div>").teleInput({value:a.split("-")[0],type:"number",range:{min:100,max:600},step:100,margintop:1}).addClass("tele-sc"),e=$("<div>").addClass("tele-sc-dash").html("_"),f=$("<div>").teleInput({value:b?a.split("-")[1]:"",type:"number",range:{min:100,max:600},step:100,margintop:1}).addClass("tele-sc");b||(e.hide(),f.hide());a=$("<div>").toggleFlip({left_value:"Single",right_value:"Range",
flip:function(){f.toggle();e.toggle()},flipped:b});c.append(a).append(d).append(e).append(f);return c}
function getRangeLB(a,b){a||(a="");var c=a.from!=a.to,d=$("<div>").addClass("tele-ip-wrap-lb"),e=$("<div>").addClass("tele-ip").ip({data:a.from}),f=$("<div>").addClass("tele-ip-dash").html("_"),g=$("<div>").addClass("tele-ip").ip({data:c?a.to:""});c||(f.hide(),g.hide());var h=$("<div>").addClass("tele-ip-add").addClass("tele-icon").addClass("tele-icon-plus").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){b.append(getRangeLB())}),k=$("<div>").addClass("tele-ip-remove").addClass("tele-icon").addClass("tele-icon-minus").hover(function(){$(this).addClass("hover")},
function(){$(this).removeClass("hover")}).click(function(){RangeRemoveLB(this)}),c=$("<div>").toggleFlip({left_value:"Single",right_value:"Range",flip:function(){g.toggle();f.toggle()},flipped:c});d.append(h).append(k).append(c).append(e).append(f).append(g);return d}function findAndRemove(a,b,c){$.each(a,function(d,e){e&&e[b]&&e[b]==c&&a.splice(d,1)})}function grabNames(a){var b="";$.each(a,function(a,d){b=b+d.key+", "});0<b.length&&(b=b.substr(0,b.length-2));return b}
function ip2long(a){var b;a=a.match(/^([1-9]\d*|0[0-7]*|0x[\da-f]+)(?:\.([1-9]\d*|0[0-7]*|0x[\da-f]+))?(?:\.([1-9]\d*|0[0-7]*|0x[\da-f]+))?(?:\.([1-9]\d*|0[0-7]*|0x[\da-f]+))?$/i);if(!a)return!1;a[0]=0;for(b=1;5>b;b+=1)a[0]+=!!(a[b]||"").length,a[b]=parseInt(a[b])||0;a.push(256,256,256,256);a[4+a[0]]*=Math.pow(256,4-a[0]);return a[1]>=a[5]||a[2]>=a[6]||a[3]>=a[7]||a[4]>=a[8]?!1:a[1]*(1===a[0]||16777216)+a[2]*(2>=a[0]||65536)+a[3]*(3>=a[0]||256)+1*a[4]}
function date_format(a,b){var c,d,e="Sun Mon Tues Wednes Thurs Fri Satur January February March April May June July August September October November December".split(" "),f=/\\?(.?)/gi,g=function(a,b){return d[a]?d[a]():b},h=function(a,b){for(a=String(a);a.length<b;)a="0"+a;return a};d={d:function(){return h(d.j(),2)},D:function(){return d.l().slice(0,3)},j:function(){return c.getDate()},l:function(){return e[d.w()]+"day"},N:function(){return d.w()||7},S:function(){var a=d.j(),b=a%10;3>=b&&1==parseInt(a%
100/10,10)&&(b=0);return["st","nd","rd"][b-1]||"th"},w:function(){return c.getDay()},z:function(){var a=new Date(d.Y(),d.n()-1,d.j()),b=new Date(d.Y(),0,1);return Math.round((a-b)/864E5)},W:function(){var a=new Date(d.Y(),d.n()-1,d.j()-d.N()+3),b=new Date(a.getFullYear(),0,4);return h(1+Math.round((a-b)/864E5/7),2)},F:function(){return e[6+d.n()]},m:function(){return h(d.n(),2)},M:function(){return d.F().slice(0,3)},n:function(){return c.getMonth()+1},t:function(){return(new Date(d.Y(),d.n(),0)).getDate()},
L:function(){var a=d.Y();return 0===a%4&0!==a%100|0===a%400},o:function(){var a=d.n(),b=d.W();return d.Y()+(12===a&&9>b?1:1===a&&9<b?-1:0)},Y:function(){return c.getFullYear()},y:function(){return d.Y().toString().slice(-2)},a:function(){return 11<c.getHours()?"pm":"am"},A:function(){return d.a().toUpperCase()},B:function(){var a=3600*c.getUTCHours(),b=60*c.getUTCMinutes(),d=c.getUTCSeconds();return h(Math.floor((a+b+d+3600)/86.4)%1E3,3)},g:function(){return d.G()%12||12},G:function(){return c.getHours()},
h:function(){return h(d.g(),2)},H:function(){return h(d.G(),2)},i:function(){return h(c.getMinutes(),2)},s:function(){return h(c.getSeconds(),2)},u:function(){return h(1E3*c.getMilliseconds(),6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)";},I:function(){var a=new Date(d.Y(),0),b=Date.UTC(d.Y(),0),c=new Date(d.Y(),6),e=Date.UTC(d.Y(),6);return a-b!==c-e?1:0},O:function(){var a=c.getTimezoneOffset(),b=Math.abs(a);return(0<a?"-":"+")+h(100*Math.floor(b/
60)+b%60,4)},P:function(){var a=d.O();return a.substr(0,3)+":"+a.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-c.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(f,g)},r:function(){return"D, d M Y H:i:s O".replace(f,g)},U:function(){return c/1E3|0}};this.date=function(a,b){c=void 0===b?new Date:b instanceof Date?new Date(b):new Date(1E3*b);return a.replace(f,g)};return this.date(a,b)}
function escapeHtml(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));return b.innerHTML}function unescapeHtml(a){var b=document.createElement("div");b.innerHTML=a;return(a=b.childNodes[0])?a.nodeValue:""}
telepath.ds={get:function(a,b,c,d,e){$.ajax({type:"POST",url:telepath.controllerPath+a,data:b,flag:e,success:function(a){a.logout?window.location.reload(!0):(a.eval&&eval(a.eval),a.console&&console.log(a.console),a.success?"function"==typeof c&&c(a,this.flag):("function"==typeof d&&d(a),"string"==typeof d&&console.log(d)))},error:function(a,b,c){"function"==typeof d&&d(b);"string"==typeof d&&console.log(d)},dataType:"json"})}};
telepath.dsync={get:function(a,b,c,d){$.ajax({type:"POST",url:telepath.controllerPath+a,data:b,async:!1,success:function(a){a.logout?window.location.reload(!0):(a.eval&&eval(a.eval),a.console&&console.log(a.console),a.success?"function"==typeof c&&c(a):("function"==typeof d&&d(a),"string"==typeof d&&console.log(d)))},error:function(a,b,c){"function"==typeof d&&d(b);"string"==typeof d&&console.log(d)},dataType:"json"})}};
$.widget("tele.infoblock",{options:{icon:"person",title:"Andy Keren",subtitle:"Developer @ HybridSec",avatar:"img/avatar.png",score:95,social:{facebook:"https://www.facebook.com/andy.keren",twitter:"https://twitter.com/NASA_Johnson/",linkedin:"www.linkedin.com/groups/Web-Fraud-Prevention-4066554"},details:{"Last Seen":"Now and again",Phone:"555-555-555",Email:"ndkeren@gmail.com",Address:"Somewhere 555 st, Let-Viva, Israel"}},_create:function(){this.element.addClass("tele-infoblock");this._update()},
_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){this.element.empty();var a=$("<div>").addClass("tele-infoblock-smalltitle").html("Client Details"),b=$("<div>").addClass("tele-infoblock-imagewrap"),c=$("<div>").addClass("tele-infoblock-score"),d=$("<img>").addClass("tele-infoblock-image").attr("src",this.options.avatar),e=$("<div>").addClass("tele-infoblock-title").html(this.options.title),f=$("<div>").addClass("tele-infoblock-subtitle").html(this.options.subtitle),g=
$("<ul>").addClass("tele-infoblock-social"),h=$("<table>").addClass("tele-infoblock-details");b.append(c).append(d);$.each(this.options.social,function(a,b){var c=$("<li>"),d=$("<a>").attr("href",b).addClass("tele-icon").addClass("tele-icon-"+a);c.append(d);g.append(c)});$.each(this.options.details,function(a,b){var c=$("<tr>"),d=$("<td>").html(a+":"),e=$("<td>").html("<b>"+b+"</b>");c.append(d).append(e);h.append(c)});this.element.append(a).append(b).append(e).append(f).append(g).append(h)}});
$.widget("tele.popup",{options:{bindTo:!1},_create:function(){this.element.addClass("tele-popup");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){if(this.options.bindTo){this.element.empty();var a=this.options.bindTo.offset().top,b=$(window).width()-this.element.width()-100;this.element.css({top:a,left:b})}}});
telepath.countries={a2n:function(a){return"undefined"!==typeof this.map[a]?this.map[a]:"Unknown"},n2a:function(a){for(x in this.map)if(this.map[x].toLowerCase()==a.toLowerCase())return x;return"00"},map:{AP:"Asia/Pacific ",AF:"Afghanistan",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",A1:"Anonymous Proxy",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BJ:"Benin",
BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia/Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"Indian Ocean",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Rep.",TD:"Chad",CL:"Chile",CN:"China",CO:"Colombia",KM:"Comoros",CD:"Congo",CG:"Congo",CK:"Cook Islands",CR:"Costa Rica",CI:"Cote D'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Curacao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",
DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",EU:"Europe",FK:"Falkland Islands",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GW:"Guinea-Bissau",GN:"Guinea",GY:"Guyana",HT:"Haiti",
VA:"Holy See",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea",KR:"Republic of Korea",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macau",MK:"Macedonia",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",
ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",MP:"Mariana Islands",NO:"Norway",KP:"North Korea",OM:"Oman",O1:"Other",PK:"Pakistan",PW:"Palau",PS:"Palestine",PA:"Panama",
PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn Islands",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Reunion",RO:"Romania",RU:"Russia",RW:"Rwanda",BL:"Saint Barthelemy",SH:"Saint Helena",KN:"Saint Kitts",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre",VC:"Saint Vincent",WS:"Samoa",SM:"San Marino",ST:"Sao Tome",A2:"Satellite Provider",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Saint Maarten",SK:"Slovakia",
SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syria",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",
UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela",VN:"Vietnam",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe","00":"Unknown"}};
$.widget("tele.teleDropdown",{options:{title:"Select",options:[],selected:0,updatesTitle:!1,icon:!1,callback:function(){},height:150,width:100},_create:function(){this.element.addClass("tele-dropdown");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;this.icon&&(this.dropdownIcon=$("<a>").attr("href","#").addClass("tele-icon").addClass("tele-icon-"+this.options.icon),this.dropdownIcon.hover(function(){a.hoverIn()},function(){a.hoverOut()}).click(function(){a.click()}),
this.element.append(this.dropdownIcon));this.dropdownValue=$("<a>").attr("href","#").addClass("tele-dropdown-value").html(this.options.value);this.dropdownArrow=$("<a>").attr("href","#").addClass("tele-dropdown-arrow").html("&nbsp;");this.element.append(this.dropdownValue).append(this.dropdownArrow);this.dropdownValue.hover(function(){a.hoverIn()},function(){a.hoverOut()}).click(function(){a.click()});this.dropdownArrow.hover(function(){a.hoverIn()},function(){a.hoverOut()}).click(function(){a.click()})},
hoverIn:function(){this.dropdownIcon&&this.dropdownIcon.addClass("hover");this.dropdownValue.addClass("hover");this.dropdownArrow.addClass("hover")},hoverOut:function(){this.dropdownIcon&&this.dropdownIcon.removeClass("hover");this.dropdownValue.removeClass("hover");this.dropdownArrow.removeClass("hover")},click:function(){if("block"==$(".tele-dd-popup").css("display"))$(".tele-dd-popup").fadeOut(),$(".tele-dd-popup").remove();else{$(".tele-dd-popup").remove();this.popup=$("<div>").addClass("tele-popup").addClass("tele-dd-popup").hide();
$(this.element).append(this.popup);$(this.element).offset();$(this.element).height();$(this.element).offset();$(this.element).width();this.popup.css({height:this.options.height,width:this.options.width}).fadeIn();this.list=$("<div>").addClass("tele-dd-list").css({height:this.options.height-30,overflow:"auto"});for(x in this.options.options){var a={key:this.options.options[x].key,label:this.options.options[x].label,inputFirst:!0,checked:!1},b=$("<div>").addClass("tele-dd-item").html(a.label);b.hover(function(){this.addClass("hover")},
function(){this.removeClass("hover")}).click(function(){this.options.callback(a)});this.list.append(b)}this.popup.append(this.list);this.options.callback&&this.options.callback()}}});
$.widget("tele.radios",{options:{items:[],selected:"time",title:"",tip:!1},_create:function(){this.element.addClass("tele-radios");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;this.element.empty();var b=$("<div>").addClass("tele-radios-title").html(this.options.title);this.element.append(b);$.each(this.options.items,function(b,d){var e=$("<div>").addClass("tele-radio");d.tip&&e.attr("alt",d.tip).attr("title",d.tip);var f=$("<div>").addClass("tele-radio-title").html(d.title),
g=$("<div>").addClass("tele-icon").addClass("tele-icon-"+d.icon);e.hover(function(){$(".tele-radio-title, .tele-icon",this).addClass("hover")},function(){$(".tele-radio-title, .tele-icon",this).removeClass("hover")});d.id==a.options.selected&&(f.addClass("selected"),g.addClass("selected"));e.append(g).append(f);a.element.append(e);e.click(function(){a._setOption("selected",d.id);a.options.callback&&a.options.callback(a,d.id)})})}});
$.widget("tele.btn",{options:{icon:!1,text:!1},_create:function(){this.element.addClass("tele-button");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;!1!==this.options.icon&&(this.iconEl=$("<span>").addClass("tele-icon tele-icon-"+this.options.icon),this.element.append(this.iconEl),this.iconEl.hover(function(){a.hoverIn()},function(){a.hoverOut()}).click(function(){a.click()}));!1!==this.options.text&&(this.textEl=$("<span>").addClass("tele-button-text").html(this.options.text),
this.textEl.hover(function(){a.hoverIn()},function(){a.hoverOut()}).click(function(){a.click()}),this.element.append(this.textEl))},hoverIn:function(){this.textEl&&this.textEl.addClass("hover");this.iconEl&&this.iconEl.addClass("hover")},hoverOut:function(){this.textEl&&this.textEl.removeClass("hover");this.iconEl&&this.iconEl.removeClass("hover")},click:function(){this.options.callback&&this.options.callback(this,this.element)}});
$.widget("tele.cb",{options:{icon:"checkbox",checked:!1},_create:function(){this.element.addClass("tele-checkbox");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;"checkbox"!=this.options.icon&&this.element.addClass("tele-checkbox-"+this.options.icon);this.element.click(function(){a.options.checked?$(this).removeClass("checked"):$(this).addClass("checked");a.options.checked=!a.options.checked;a.options.callback&&a.options.callback(a)})}});
telepath.search={results:{},defaults:{application:!0,pages:!0,attributes:!0,requests:!0,suspects:!0,alerts:!0,cases:!0,request_data:!0,users:!1},sort:"date",dir:!1,options:!1,searchTypes:[{id:"cases",label:"Request Data",desc:"Search Cases"},{id:"alerts",label:"Applications",desc:"Search Alerts"},{id:"suspects",label:"Request Data",desc:"Search suspects"},{id:"requests",label:"Requests",desc:"Search Requests"},{id:"request_data",label:"Request Data",desc:"Search request data"},{id:"application",label:"Applications",
desc:"Search domain names"},{id:"pages",label:"Applications",desc:"Search application page names"},{id:"attributes",label:"Applications",desc:"Search attribute names"},{id:"users",label:"Request Data",desc:"Search web application users"},{id:"users",label:"Request Data",desc:"Search in countries and cities"}],printTypes:function(a){var b=this;!1===this.options&&(this.options=this.defaults);$.each(b.searchTypes,function(c,d){var e=$("<div>").addClass("tele-search-filter").attr("id","tele-search-filter-"+
d.id),f=$("<div>").addClass("tele-search-filter").teleCheckbox({label:d.desc,checked:b.options[d.id]?b.options[d.id]:!1,callback:function(a){b.options[d.id]=a.options.checked}});e.append(f);a.append(e)});b.buttonsEl=$("<div>").addClass("tele-form-buttons");b.applyBtn=$('<a href="#" class="tele-button tele-button-apply">Apply</a>');b.cancelBtn=$('<a href="#" class="tele-button tele-button-cancel">Cancel</a>');b.buttonsEl.append(b.applyBtn).append(b.cancelBtn);a.append(b.buttonsEl);b.applyBtn.click(function(){$(".tele-search-filters").remove()});
b.cancelBtn.click(function(){b.options=b.defaults;$(".tele-search-filters").remove()})},searchStr:"",init:function(a){this.searchStr=a;telepath.header.configCmd.removeClass("active");$(".tele-nav a.active").removeClass("active");$(".tele-panel").empty().hide().removeClass("active");$("#file-upload").hide();$(".tele-panel-search").show().addClass("active");this.container=$(".tele-panel-search");this.container.empty();this.initPanel()},initPanel:function(){var a=this;this.panelTopBar=$("<div>").addClass("tele-panel-topbar");
this.panelTitle=$("<div>").addClass("tele-panel-title");this.panelTopBar.append(this.panelTitle);this.panelTitle.html("Search results");this.container.append(this.panelTopBar);this.panelSubBar=$("<div>").addClass("tele-panel-subtitle");this.panelTopBarRight=$("<div>").addClass("tele-panel-topbar-right");this.panelTopBar.append(this.panelTopBarRight);this.container.append(this.panelSubBar);var b=$("<div>").radios({title:"Sort By",items:[{id:"date",icon:"time",tip:"Time"},{id:"count",icon:"bars",tip:"Count"}],
selected:this.sort,callback:function(b,c){a.sort==c&&(a.dir=!a.dir);a.sort=c;telepath.search.refresh(function(){})}}),c=$("<div>").daterange({start:telepath.range.start,end:telepath.range.end,change:function(a,b){telepath.range.start=a;telepath.range.end=b;$(".tele-search-tab span").html("0");telepath.search.refresh(function(){})}}),d=$("<div>").appSelect({callback:function(a){$(".tele-icon-application",d).removeClass("tele-icon-application").addClass("tele-icon-loader");telepath.search.refresh(function(){$(".tele-icon-loader",
d).removeClass("tele-icon-loader").addClass("tele-icon-application")})}});this.panelTopBarRight.append(b).append('<div class="tele-navsep"></div>').append(c).append('<div class="tele-navsep"></div>').append(d);this.tabsEl=$("<div>").addClass("tabs");this.tabsUl=$("<ul>");this.tabsEl.append(this.tabsUl);b=[{id:"alerts",text:"Alerts"},{id:"cases",text:"Cases"},{id:"suspects",text:"Suspects"},{id:"requests",text:"Normal"}];for(x in b){var e=b[x],c=$("<div>").attr("id","tele-search-"+e.id),f=$("<li>"),
g=$("<span>").html("0"),e=$("<a>").attr("href","#tele-search-"+e.id).append(e.text+"&nbsp;(").append(g).append(")").attr("rel",e.id).addClass("tele-search-tab");f.append(e);this.tabsUl.append(f);this.tabsEl.append(c)}this.container.append(this.tabsEl);this.tabsEl.height($(window).height()-$(".tele-header").height()-$(".tele-panel-topbar").height()-$(".tele-panel-subtitle").height()-60);this.tabsEl.tabs({heightStyle:"fill",autoHeight:!1,animate:!1,activate:function(b,c){var d=c.newPanel.selector.split("-")[2];
a.container=$(c.newPanel.selector);$(c.newPanel.selector+" .tele-block").remove();switch(d){case "cases":a.showCasesTab(c.newPanel.selector);break;case "alerts":a.showAlertsTab(c.newPanel.selector);break;case "suspects":a.showSuspectsTab(c.newPanel.selector);break;case "requests":a.showRequestsTab(c.newPanel.selector)}},create:function(a,b){}});this.tabsEl.tabs({collapsible:!0,active:!1});this.panelSubBar.append(this.tabsUl);this.refresh()},refresh:function(){if(!this.searchStr)return $.each(["alerts",
"cases","suspects","requests"],function(a,b){var e=$("#tele-search-"+b);e.empty();e.append($("<p>").text("No search string defined"))}),this.tabsEl.tabs({collapsible:!1}),!1;$(".ui-tabs").append(telepath.loader);var a=this;this.results={};!1===this.options&&(this.options=this.defaults);"00"!=telepath.countries.n2a(this.searchStr)?(this.searchStr=telepath.countries.n2a(this.searchStr),$(".tele-search-input").val(this.searchStr),this.countryFlag=!0):this.countryFlag=!1;var b={search:this.searchStr,
options:this.options,range:telepath.range,apps:telepath.appFilter,is_country:this.countryFlag,sort:this.sort,dir:this.dir};a.count=0;$.each(["alerts","cases","suspects","requests"],function(c,d){if(a.options[d])telepath.ds.get("/search/"+d,b,function(b){a.count++;a.container=$("#tele-search-"+d);a.container.empty();b.items&&0!=b.items.length?(a.results[d]=b.items,$('.tele-search-tab[rel="'+d+'"] span').html(b.total)):(b=$("<p>").text("No results"),a.container.append(b));4==a.count&&a.selectTab()},
function(b){a.count++;4==a.count&&a.selectTab();a.container=$("#tele-search-"+d);a.container.empty();b=$("<p>").text(b.error);a.container.append(b)});else{a.count++;4==a.count&&a.selectTab();a.container=$("#tele-search-"+d);a.container.empty();var e=$("<p>").text("No select option "+d);a.container.append(e)}})},selectTab:function(){var a=this;a.tabsEl.children(".tele-loader").remove();var b=!1;$.each(["alerts","cases","suspects","requests"],function(c,d){if(!b&&a.results[d]&&0<a.results[d].length){var e;
switch(d){case "alerts":e=0;a.showAlertsTab();break;case "cases":e=1;a.showCasesTab();break;case "suspects":e=2;a.showSuspectsTab();break;case "requests":e=3,a.showRequestsTab()}a.tabsEl.tabs({active:e});b=!0}});a.tabsEl.tabs({collapsible:!1})},showCasesTab:function(){this.list=$("<div>").addClass("tele-cases-block");$("#tele-search-cases").append(this.list);this.list.teleList({data:this.results.cases,searchkey:this.searchStr,formatter:function(a){a._source&&(a=a._source);a.checkable||(a.checkable=
!1);a.favorites||(a.favorites=!1,a.favorite=!1);var b="";$.each(a.cases_names,function(a,d){b=b+d.key+" ,"});b=b.substr(0,b.length-2);return{raw:a,checkable:!1,favorites:!1,favorite:!1,itemID:a.sid,icon:"case",title:b,count:a.count,details:[{key:"IP",value:a.ip_orig},{key:"country",value:a.country},{key:"city",value:a.city},{key:"host",value:grabNames(a.host)},{key:"alerts",value:a.alerts_count},{key:"actions",value:a.actions_count}]}}})},showAlertsTab:function(){this.results.alerts&&(this.list=$("<div>").addClass("tele-alerts-block"),
$("#tele-search-alerts").append(this.list),this.list.teleList({data:this.results.alerts,searchkey:this.searchStr,formatter:function(a){return telepath.alert.rowFormatter(a)}}))},showSuspectsTab:function(){this.results.suspects&&(this.list=$("<div>").addClass("tele-suspects-block"),$("#tele-search-suspects").append(this.list),this.list.teleList({data:this.results.suspects,searchkey:this.searchStr,formatter:function(a){return telepath.suspects.rowFormatter(a)}}))},showRequestsTab:function(){this.results.requests&&
(this.list=$("<div>").addClass("tele-requests-block"),$("#tele-search-requests").append(this.list),this.list.teleList({data:this.results.requests,searchkey:this.searchStr,formatter:function(a){return telepath.suspects.rowFormatter(a)}}))}};
$.widget("tele.listitem",{options:{itemID:0,checkable:!1,checked:!1,favorites:!1,favorite:!1,favoriteCallBack:!1,count:!1,time:!1,timeFormat:"d/m/y g:i A",timeLabel:"",progbar:!1,progbarValue:0,progbarBig:!1,popup:!1,icon:"alert",title:"",description:"",details:[],offset:30,raw:[]},_resize:function(){var a=this.options.offset;$(".tele-checkbox",this.element).each(function(){a+=$(this).outerWidth(!0)});30>a&&(a+=20);var b=$(this.element).width()-a;$(".tele-listitem-inner",this.element).width(b-15);
a=15;this.options.progbar&&(a=this.options.progbarBig?a+$(".tele-listitem-bigprogbar",this.element).outerWidth()+55:a+$(".tele-listitem-progbar",this.element).outerWidth()+25);this.options.icon&&(a+=$(".tele-listitem-icon",this.element).outerWidth());var c=b-a;$(".tele-listitem-info",this.element).css({width:c});var d=30;800>$(".tele-listitem-info").width()?$("ul li").filter("[class*=tele-listitem-]").css({"padding-right":"5%"}):$("ul li").filter("[class*=tele-listitem-]").css({"padding-right":"10%"});
$(".tele-listitem-info li",this.element).each(function(){$(this).show();$(this).prev().css({borderRightWidth:1});d+=$(this).outerWidth();if(d>c)if($(this).hasClass("tele-list-hosts")){var a=$(this).width(),b=d-c;$(this).width(a-b).css({"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",height:"15px"});a=$("b",this).text();b=a.split(",");1<b.length&&(b=$("<a>View all "+b.length+" hosts</a>"),$("b",this).html(b),$(".tele-list-hosts a").tipsy({fallback:a,gravity:"sw",trigger:"hover"}));
d+=$(this).outerWidth();d>c&&($(this).hide(),$(this).prev().css({borderRightWidth:0}))}else $(this).hide(),$(this).prev().css({borderRightWidth:0});else $(this).hasClass("tele-list-hosts")&&$(this).css({width:"auto"})})},_create:function(){this.element.addClass("tele-listitem");this._update()},_setOption:function(a,b){this.options[a]=b;"checked"==a?b?this.checkEl.teleCheckbox({checked:!0}):this.checkEl.teleCheckbox({checked:!1}):this._update()},_update:function(){var a=this;this.element.empty();this.options.checkable&&
(this.checkEl=$("<a>").teleCheckbox({checked:this.options.checked,callback:function(b){a.options.checked=b.options.checked}}),this.element.append(this.checkEl));this.options.favorites&&(this.favEl=$("<a>").teleCheckbox({icon:"favorites",checked:this.options.favorite,callback:function(b){a.options.favorite=b.options.checked;"function"==typeof a.options.favoriteCallBack&&a.options.favoriteCallBack(a)}}),this.element.append(this.favEl));var b=$("<div>").addClass("tele-listitem-inner");this.element.append(b);
if(this.options.icon){var c=$("<div>").addClass("tele-listitem-icon").addClass("tele-icon-"+this.options.icon);b.append(c)}this.options.count&&(c=$("<div>").addClass("tele-listitem-count").html(this.options.count),b.append(c),999<parseInt(this.options.count)&&c.css({fontSize:"12px",left:"30px"}));if(this.options.progbar){c=$("<div>");this.options.progbarBig?c.addClass("tele-listitem-bigprogbar"):c.addClass("tele-listitem-progbar");this.options.progbarValue=parseFloat(this.options.progbarValue);0<
this.options.progbarValue&&(this.options.progbarValue=1>=this.options.progbarValue?100*this.options.progbarValue:parseInt(this.options.progbarValue));var d=$("<div>").addClass("tele-listitem-progbar-inner").css({width:this.options.progbarValue+"%"});c.append(d);b.append(c)}this.options.title&&(c=$("<div>").addClass("tele-listitem-title").html(this.options.title).attr("title",this.options.title),b.append(c));this.options.updating&&(c=$("<div>").addClass("tele-listitem-updating tele-icon-ring").html("Update in progress").attr("title",
"Update in progress"),b.append(c));this.options.description&&(c=$("<div>").addClass("tele-title-2").html(this.options.description),b.append(c));if(this.options.details&&0<this.options.details.length){var e=$("<ul>").addClass("tele-listitem-info");this.options.title||e.addClass("no-title");$.each(this.options.details,function(a,b){if(b.key||b.value){var c=$("<li>");switch(b.key){case "Active":var d=$("<span>"),l=$("<span>");b.value?(d.addClass("tele-icon-active"),l.text("Active")):(d.addClass("tele-icon-inactive"),
l.text("Inactive"));c.append(d).append(l);break;case "city":b.key&&"city"==b.key&&b.value&&"Unknown"!=b.value?c.append(b.key).append(":&nbsp;").append("<b>"+escapeHtml(b.value)+"</b>"):c=!1;break;case "user":b.key&&"user"==b.key&&b.value&&""!=b.value?(d=$("<div>").addClass("tele-listitem-user-name"),c.append(d).append("&nbsp&nbsp;").append(escapeHtml(b.value))):c=!1;break;case "Email":d=$("<a>").attr("href","mailto:"+escapeHtml(b.value)).text(escapeHtml(b.value));c.append(d);break;case "country":2==
b.value.length?(c.append('<span class="flag flag-'+escapeHtml(b.value)+'"></span>'),c.append('<span class="tele-country">'+telepath.countries.a2n(b.value)+"</span>")):(c.append(b.key),b.value&&c.append(":&nbsp;"),c.append("<b>"+escapeHtml(b.value)+"</b>"));break;case "alerts":0<parseInt(b.value)?(d=$("<div>").addClass("tele-listitem-icon").addClass("tele-icon-alert"),l=$("<div>").addClass("tele-listitem-count").html(escapeHtml(b.value)),c.addClass("tele-listitem-alerts-count"),c.append(d).append(l)):
c=!1;break;case "actions":0<parseInt(b.value)?(d=$("<div>").addClass("tele-listitem-icon").addClass("tele-icon-actions"),l=$("<div>").addClass("tele-listitem-count").html(escapeHtml(b.value)),c.addClass("tele-listitem-actions-count"),c.append(d).append(l)):c=!1;break;case "cases":0<parseInt(b.value)?(d=$("<div>").addClass("tele-listitem-icon tele-icon-case"),l=$("<div>").addClass("tele-listitem-count").html(escapeHtml(b.value)),c.addClass("tele-listitem-cases-count"),c.append(d).append(l)):c=!1;break;
default:b.key&&(c.append(b.key),b.value&&c.append(":&nbsp;")),b.value&&c.append("<b>"+escapeHtml(b.value)+"</b>")}!1!==c&&e.append(c)}});b.append(e)}!1!==this.options.time&&(c=$("<div>").addClass("tele-listitem-time").html(date_format(this.options.timeFormat,this.options.time)),this.options.timeLabel&&c.prepend("<label>"+this.options.timeLabel+"</label>"),b.append(c));this._resize();$(window).resize(function(){a.timer&&clearTimeout(a.timer);a.timer=setTimeout(function(){a._resize()},50)});b.hover(function(){$(this).addClass("hover")},
function(){$(this).removeClass("hover")}).click(function(){a.options.callback&&a.options.callback(a)})},bindPopup:function(){this.element.hover(function(){},function(){})}});telepath.listitem||(telepath.listitem={});
telepath.listitem.generic={formatter_dashboard:function(a){return telepath.listitem.generic.formatter(a,"dashboard")},formatter:function(a,b){return result="dashboard"==b?{raw:a,icon:"suspect",time:a.ts,progbar:!0,itemID:a.sid,progbarBig:a.progbarBig,checkable:a.checkable,checked:a.checked,count:a.count,progbarValue:a.ip_score,time:a.date,details:[{key:"country",value:a.country},{key:"IP",value:a.ip_orig},{key:"host",value:grabNames(a.host)}]}:{raw:a,icon:"suspect",time:a.ts,progbar:!0,itemID:a.sid,
progbarBig:a.progbarBig,checkable:a.checkable,checked:a.checked,count:a.count,progbarValue:a.ip_score,time:a.date,details:[{key:"country",value:a.country},{key:"IP",value:a.ip_orig},{key:"city",value:a.city},{key:"host",value:grabNames(a.host)},{key:"alerts",value:a.alerts_count},{key:"actions",value:a.actions_count},{key:"cases",value:row.cases_count},{key:"user",value:a.user}]}},callbacks:{click:function(a){$(".popover").remove();setTimeout(function(){$(".popover").remove()},1E3);var b=a.element.parent().parent();
telepath.sessionflow.init(a.options.itemID,a.options.raw.ip_orig,b,a.options.icon,a.options.raw.alerts_names?a.options.raw.alerts_names:[],a.options.raw.searchkey)},hover_in:function(a,b){if(b){telepath.generic_popover_timer&&clearTimeout(telepath.generic_popover_timer);$(".popover").remove();telepath.generic_popover&&telepath.generic_popover.remove();telepath.generic_popover=$("<div>");$("body").append(telepath.generic_popover);if($(a).hasClass("tele-icon-alert")&&b.raw.alerts_count&&0<b.raw.alerts_count&&
b.raw.alerts_names&&0<b.raw.alerts_names.length){var c=$("<div>").addClass("popover-content");$.each(b.raw.alerts_names,function(a,b){var d=$("<div>").addClass("tele-popover-row").append($("<div>").addClass("tele-icon").addClass("tele-icon-alert")).append($("<div>").addClass("tele-count").text(b.doc_count)).append($("<div>").addClass("tele-popover-subtitle").html(b.key));c.append(d)});$(telepath.generic_popover).css({position:"absolute",top:$(a).offset().top-45,left:$(a).offset().left+40}).fadeIn().popover({title:"Alerts",
html:!0}).popover("show");$(".popover").append(c);var d=$(".popover").height()/2;d&&$(".popover").css({position:"absolute",top:$(a).offset().top-d,left:$(a).offset().left+40})}if($(a).hasClass("tele-icon-actions")&&b.raw.actions_count&&0<b.raw.actions_count&&b.raw.actions_names&&0<b.raw.actions_names.length){var e=$("<div>").addClass("popover-content");$.each(b.raw.actions_names,function(a,b){var c=$("<div>").addClass("tele-popover-row").append($("<div>").addClass("tele-icon").addClass("tele-icon-actions")).append($("<div>").addClass("tele-count").text(b.doc_count)).append($("<div>").addClass("tele-popover-subtitle").html(b.key));
e.append(c)});$(telepath.generic_popover).css({position:"absolute",top:$(a).offset().top-45,left:$(a).offset().left+40}).fadeIn().popover({title:"Actions",html:!0}).popover("show");$(".popover").append(e);(d=$(".popover").height()/2)&&$(".popover").css({position:"absolute",top:$(a).offset().top-d,left:$(a).offset().left+40})}if($(a).hasClass("tele-icon-case")&&b.raw.cases_count&&0<b.raw.cases_count&&b.raw.cases_names&&0<b.raw.cases_names.length){var f=$("<div>").addClass("popover-content");$.each(b.raw.cases_names,
function(a,b){var c=$("<div>").addClass("tele-popover-row").append($("<div>").addClass("tele-icon").addClass("tele-icon-case")).append($("<div>").addClass("tele-count").text(b.doc_count)).append($("<div>").addClass("tele-popover-subtitle").html(b.key));f.append(c)});$(telepath.generic_popover).css({position:"absolute",top:$(a).offset().top-45,left:$(a).offset().left+40}).fadeIn().popover({title:"Cases",html:!0}).popover("show");$(".popover").append(f);(d=$(".popover").height()/2)&&$(".popover").css({position:"absolute",
top:$(a).offset().top-d,left:$(a).offset().left+40})}if($(a).hasClass("tele-listitem-progbar")){var d=$(a).offset().left,g;d+422>$(window).width()?(d-=10,g="left"):(d+=100,g="right");$(telepath.generic_popover).css({position:"absolute",top:$(a).offset().top-2,left:d}).fadeIn().popover({title:"Loading anomaly scores..",html:!0,placement:g,content:telepath.loader}).popover("show");telepath.ds.get("/sessionflow/get_session_stats",{sid:b.itemID},function(a){$(".popover-title:first").html("Anomaly Scores");
$(".popover-content .tele-loader").after($("<div>").anomalyScore({request:a.items})).remove()})}}},hover_out:function(a,b){telepath.generic_popover_timer=setTimeout(function(){$(".popover").fadeOut(function(){$(".popover").remove()})},500)},favorite:function(a){telepath.ds.get("/cases/set_case_fav",{cid:a.options.dataID,favorite:a.options.favorite},function(a){})}},callbacks_case:{click:function(a){telepath.access.admin||telepath.access.perm.Cases_get?($(".tele-nav-cases a").click(),$(".popover").remove(),
telepath.casePanel.init(a.options.dataID)):telepath.dialog({msg:"Access denied. No permissions to view Cases details."})},hover_in:function(a,b){var c=b.dataID;$(".popover").remove();telepath.cases.pop&&telepath.cases.pop.remove();telepath.cases.pop=$("<div>").css({position:"absolute",top:$(a).offset().top,left:$(a).offset().left+70});$("body").append(telepath.cases.pop);$(telepath.cases.pop).popover({title:"Loading Data",html:!0,content:telepath.loader}).popover("show");telepath.ds.get("/cases/get_case_stat",
{cid:c},function(a){a=[{label:"Sessions",data:a.items,color:"#FC3D3D"}];var b=$("<div>").addClass("case-popover-graph");$(".popover-title").html("Case Activity");$(".popover-content").empty().append(b);b.flotGraph({data:a,options:{legend:{show:!1},series:{lines:{show:!0,fill:!0},points:{show:!0,fillColor:"#446077"}},yaxis:{alignTicksWithAxis:!0,labelWidth:30,ticks:5,color:"#446077",font:{family:"Arial",color:"#cccccc",size:11,weight:"normal"}},selection:{mode:"x"},xaxis:{alignTicksWithAxis:!0,tickColor:"#cccccc",
tickLength:7,font:{family:"Arial",color:"#cccccc",size:11,weight:"normal"},mode:"time",timezone:"browser",timeformat:"%d/%m"},grid:{borderColor:"#446077",borderWidth:1}}})})},hover_out:function(a,b){telepath.cases.timeout&&clearTimeout(telepath.cases.timeout);telepath.cases.pop&&telepath.cases.pop.remove()},favorite:function(a){telepath.ds.get("/cases/set_case_fav",{cid:a.options.title,favorite:a.options.favorite},function(a){})}}};
$.widget("tele.toggleFlip",{options:{left_value:"On",right_value:"Off",flipped:!1,flip:!1,disabled:!1},_create:function(){this.element.addClass("tele-mini-toggle");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this,b=$("<div>").addClass("tele-mini-toggle-left").html(this.options.left_value),c=$("<div>").addClass("tele-mini-toggle-right").html(this.options.right_value),d=$("<div>").addClass("tele-mini-toggle-middle"),e=$("<a>").attr("href","#").addClass("tele-mini-toggle-knob").html("&nbsp;");
d.append(e);this.element.empty().append(b).append(d).append(c);this.options.flipped&&(e.addClass("active"),e.css({marginLeft:20}));this.options.disabled?this.element.css({opacity:.3}):e.click(function(b){b.preventDefault();a.options.flipped?($(this).removeClass("active"),$(this).animate({marginLeft:0},300)):($(this).addClass("active"),$(this).animate({marginLeft:20},300));a.options.flipped=!a.options.flipped;"function"==typeof a.options.flip&&a.options.flip(a.options.flipped)})}});
$.widget("tele.daterange",{options:{start:(new Date).getTime(),end:(new Date).getTime(),change:!1,state:""},_create:function(){this.element.addClass("tele-daterange");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_displayPopup:function(){function a(a){var b=a.val();if(""==b)return a.val(""),0;b=b.split(":");if(2==b.length)return 36E5*parseInt(b[0])+6E4*parseInt(b[1]);a.val("");return 0}var b=this;0==$(".tele-daterange-popup").size()&&$("body").append(telepath.templates["popup-daterange"]);
if("block"==$(".tele-daterange-popup").css("display"))$(".tele-daterange-popup").fadeOut();else{var c=$(".tele-daterange:last").offset().top+$(".tele-daterange:last").height()+20,d=$(".tele-daterange:last").offset().left+$(".tele-daterange:last").width()/2-$(".tele-daterange-popup").width()/2;$(".tele-daterange-popup").css({top:c,left:d});$(".tele-daterange-popup").fadeIn();$.datepicker._defaults.dateFormat="dd/mm/yy";$(".tele-daterange-calendar").datepicker({numberOfMonths:[1,2],beforeShowDay:function(a){var b=
$.datepicker.parseDate($.datepicker._defaults.dateFormat,$(".tele-daterange-from").val()),c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,$(".tele-daterange-to").val());return[!0,b&&(a.getTime()==b.getTime()||c&&a>=b&&a<=c)?"dp-highlight":""]},onSelect:function(a,b){var c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,$(".tele-daterange-from").val()),d=$.datepicker.parseDate($.datepicker._defaults.dateFormat,$(".tele-daterange-to").val()),k=$.datepicker.parseDate($.datepicker._defaults.dateFormat,
a);!c||d?($(".tele-daterange-from").val(a),$(".tele-daterange-from-hour").val("00:00"),$(".tele-daterange-to").val(""),$(".tele-daterange-to-hour").val("23:59")):k<c?($(".tele-daterange-to").val($(".tele-daterange-from").val()),$(".tele-daterange-to-hour").val($(".tele-daterange-from-hours").val()),$(".tele-daterange-from").val(a),$(".tele-daterange-from-hour").val("00:00")):($(".tele-daterange-to").val(a),$(".tele-daterange-to-hour").val("23:59"));$(this).datepicker()}});$(".tele-daterange-period a").click(function(){$(".tele-daterange-period a.active").removeClass("active");
b.options.state=$(this).attr("class").split("-")[3];$(this).addClass("active");b.setPeriod()});$(".tele-daterange-buttons .tele-button-apply").click(function(){$(".tele-daterange-popup").fadeOut();if("function"==typeof b.options.change)if($(".tele-daterange-period a.active").length&&(telepath.range.state=$(".tele-daterange-period a.active").attr("class").split(/-| /)[3]),"range"==telepath.range.state){var c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,$(".tele-daterange-from").val()),
d=$.datepicker.parseDate($.datepicker._defaults.dateFormat,$(".tele-daterange-to").val()),g=a($(".tele-daterange-from-hour")),h=a($(".tele-daterange-to-hour"));telepath.range.start=parseInt((c.getTime()+g)/1E3);telepath.range.end=parseInt((d.getTime()+h)/1E3);telepath.ds.get("/telepath/set_time_range",{state:telepath.range.state,start:telepath.range.start,end:telepath.range.end},function(a){b.options.change(telepath.range.start,telepath.range.end);b.options.state=telepath.range.state;b.options.start=
telepath.range.start;b.options.end=telepath.range.end;b._update()})}else telepath.ds.get("/telepath/set_time_range",{state:telepath.range.state},function(a){b.options.state=telepath.range.state;a=new Date;switch(b.options.state){case "data":telepath.range.start=telepath.fullRangeStart;break;case "year":a.setFullYear(a.getFullYear()-1);break;case "month":a.setMonth(a.getMonth()-1);break;case "week":a.setDate(a.getDate()-7);break;case "day":a.setDate(a.getDate()-1);break;case "hour":a.setHours(a.getHours()-
1)}"data"!=b.options.state&&(telepath.range.start=parseInt(a.getTime()/1E3));telepath.range.end=parseInt((new Date).getTime()/1E3);b.options.start=telepath.range.start;b.options.end=telepath.range.end;b.options.change(telepath.range.start,telepath.range.end);b._update()})});$(".tele-daterange-buttons .tele-button-cancel").click(function(){$(".tele-daterange-popup").fadeOut()});this.updateUI()}},_update:function(){this.updateUI()},setPeriod:function(){var a=this;$(".tele-darerange-container").addClass("disabled");
"range"==a.options.state&&($(".tele-darerange-container").removeClass("disabled"),telepath.ds.get("/telepath/set_full_time_range",{},function(b){telepath.range.start=b.items.start;telepath.range.end=b.items.end;a.options.start=telepath.range.start;a.options.end=telepath.range.end}));$(".tele-daterange-to").val(date_format("d/m/Y",telepath.range.end));$(".tele-daterange-to-hour").val(date_format("H:i",telepath.range.end));$(".tele-daterange-from").val(date_format("d/m/Y",telepath.range.start));$(".tele-daterange-from-hour").val(date_format("H:i",
telepath.range.start))},updateUI:function(){var a=this;this.button&&this.button.remove();$(".tele-daterange-period a.active").removeClass("active");$(".tele-daterange-period a").each(function(){$(this).attr("class").split("-")[3]==telepath.range.state&&$(this).addClass("active")});$(".tele-darerange-container").addClass("disabled");if("range"==telepath.range.state){var b=date_format("d/m/Y",this.options.start)+" - "+date_format("d/m/Y",this.options.end);$(".tele-darerange-container").removeClass("disabled")}else b=
"data"==telepath.range.state?"All Data":"Last "+telepath.range.state[0].toUpperCase()+telepath.range.state.slice(1);this.button=$("<a>").attr("href","#").btn({icon:"daterange",text:b,callback:function(){a._displayPopup(this)}});this.element.append(this.button);$(".tele-daterange-from").val(date_format("d/m/Y",this.options.start));$(".tele-daterange-from-hour").val(date_format("H:i",this.options.start));$(".tele-daterange-to").val(date_format("d/m/Y",this.options.end));$(".tele-daterange-to-hour").val(date_format("H:i",
this.options.end))}});
$.widget("tele.flotGraph",{options:{data:[],options:[],dashboard:!1,title:!1},_create:function(){this.element.addClass("tele-graph");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;this.canvasOuter=$("<div>").addClass("tele-graph-canvas-outer");this.canvasInner=$("<div>").addClass("tele-graph-canvas");this.element.empty();if(this.options.title){var b=$("<div>").addClass("tele-graph-title").html(this.options.title);this.element.append(b)}this.canvasOuter.append(this.canvasInner);this.element.append(this.canvasOuter);
if(this.options.dashboard){this.filterTypes=[{type:"noncase-alerts",label:"Alerts",count:0,active:!0,suffix:"Tx"},{type:"case-alerts",label:"Cases",count:0,active:!0,suffix:"Tx"},{type:"suspicions",label:"Suspects",count:0,active:!0,suffix:"Tx"},{type:"other-sessions",label:"Normal",count:0,active:!0,suffix:"Tx"}];var c=0;$.each(a.filterTypes,function(b,e){$.each(a.options.data,function(a,b){b.label==e.label&&(e.count=0,$.each(b.data,function(a,b){e.count+=parseInt(b[1]);c+=parseInt(b[1])}))})});
this.dashboardGraphFilters=$("<div>").addClass("tele-dashboard-graph-filters");$(".tele-graph-canvas-outer").append(this.dashboardGraphFilters);$.each(this.filterTypes,function(b,e){var f=$("<div>").addClass("tele-dashboard-graph-filter").addClass("tele-graph-filter-"+e.type),g=$("<a>").attr("href","#").addClass("tele-graph-filter-toggle").html("&nbsp;"),h=$("<div>").addClass("tele-graph-filter-title").text(e.label),k=$("<div>").addClass("tele-graph-filter-percent").text((0<c?parseFloat(e.count/c*
100).toFixed(2):0)+"%"),l=$("<div>").addClass("tele-graph-filter-count").text(e.count+" "+e.suffix);f.append(g).append(h).append(k).append(l);a.dashboardGraphFilters.append(f);k.css({marginRight:160-h.width()});l.css({marginRight:160-h.width()});e.active&&g.addClass("active");g.click(function(){$(this).hasClass("active")?($(this).removeClass("active"),a.filterTypes[b].active=!1):($(this).addClass("active"),a.filterTypes[b].active=!0);a.updateFilters()})});this.resize();this.dashboardGraphFilters.resize(function(){a.resize()});
this.updateFilters()}this.printData=this.options.data;this.plot()},updateFilters:function(){var a=this;this.printData=[];$.each(a.filterTypes,function(b,c){c.active&&$.each(a.options.data,function(b,e){e.label==c.label&&a.printData.push(e)})});this.plot()},plot:function(){this.plotObj=$.plot(this.canvasInner,this.printData,this.options.options)},resize:function(){var a=this.dashboardGraphFilters.width();$(".tele-dashboard-graph-filter").css({margin:0});var b=$(".tele-dashboard-graph-filter").outerWidth(),
b=Math.floor(Math.floor(a-b*this.filterTypes.length)/this.filterTypes.length)-1;$(".tele-dashboard-graph-filter").css({marginRight:b});$(".tele-graph-filter-title").css({fontSize:800>a?"16px":"20px"})}});
$.widget("tele.vMap",{options:{data:[],title:!1},_create:function(){this.element.addClass("tele-map");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){this.element.empty();if(this.options.title){var a=$("<div>").addClass("tele-graph-title").html(this.options.title);this.element.append(a)}var b=0,c=0;$.each(this.options.data,function(a,d){"00"!==a&&d>b&&(b=d);c+=d});this.scaleWrap=$("<div>").addClass("tele-scale-wrap");this.scaleLeft=$("<div>").addClass("tele-scale-left").html("0");
this.scaleGrad=$("<div>").addClass("tele-scale-grad");this.scaleRight=$("<div>").addClass("tele-scale-right").html(b.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" ("+c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+")");this.scaleWrap.append(this.scaleLeft).append(this.scaleGrad).append(this.scaleRight);this.vectorMap=$("<div>").css({clear:"both",height:300,padding:"15px 0px 0px 0px"});this.element.append(this.scaleWrap);this.element.append(this.vectorMap);var d=[];$.each(this.options.data,function(a,
b){d[a.toLowerCase()]=b});this.vectorMap.vectorMap({map:"world_en",backgroundColor:"#304F68",color:"#C4E8B2",hoverOpacity:.7,selectedColor:"#666666",enableZoom:!0,showTooltip:!0,values:d,scaleColors:["#C4E8B2","#60BB3C"],normalizeFunction:"polynomial",onRegionClick:function(a,b){telepath.alerts.searchString="country_code:"+b.toUpperCase();$(".tele-nav-alerts a").click();setTimeout(function(){$(".tele-panel-alerts .tele-search-input").val(telepath.alerts.searchString);$(".jqvmap-label").remove()},
100)},onLabelShow:function(a,b,c){a=$("<div>").addClass("tele-popover-row");var d=$("<div>").addClass("tele-icon tele-icon-alert"),k=$("<div>").addClass("tele-count").html(telepath.dashboard.data.items.map[c.toUpperCase()]?telepath.dashboard.data.items.map[c.toUpperCase()]:0);c=$("<span>").addClass("tele-popover-subtitle").html(telepath.countries.a2n(c.toUpperCase()));a.append(d).append(k).append(c);b.empty();b.append(a)}})}});
$.widget("tele.anomalyScore",{options:{request:[]},_create:function(){this.element.addClass("tele-anomaly-score");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;this.options.speed=this.options.request.score_landing;this.options.direction=this.options.request.score_flow;this.options.query=this.options.request.score_query;this.options.location=this.options.request.score_geo;$.each(["speed","direction","query","location"],function(b,c){var d=
parseInt(100*a.options[c]),e=$("<div>").addClass("tele-anomaly-wrap"),f=$("<div>").addClass("tele-anomaly-icon").addClass("tele-icon-"+c),g=$("<div>").addClass("tele-anomaly-text").html(c.charAt(0).toUpperCase()+c.slice(1)),h=$("<div>").addClass("tele-anomaly-value").html(d+"%");e.append(f).append(g).append(h);25<d&&(f.addClass("active"),g.addClass("active"),h.addClass("active"));a.element.append(e)})}});
$.widget("tele.anomalyScore",{options:{request:[]},_create:function(){this.element.addClass("tele-anomaly-score");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;this.options.speed=this.options.request.score_landing;this.options.direction=this.options.request.score_flow;this.options.query=this.options.request.score_query;this.options.location=this.options.request.score_geo;$.each(["speed","direction","query","location"],function(b,c){var d=
parseInt(100*a.options[c]),e=$("<div>").addClass("tele-anomaly-wrap"),f=$("<div>").addClass("tele-anomaly-icon").addClass("tele-icon-"+c),g=$("<div>").addClass("tele-anomaly-text").html(c.charAt(0).toUpperCase()+c.slice(1)),h=$("<div>").addClass("tele-anomaly-value").html(d+"%");e.append(f).append(g).append(h);25<d&&(f.addClass("active"),g.addClass("active"),h.addClass("active"));a.element.append(e)})}});
$.widget("tele.anomalyScore",{options:{request:[]},_create:function(){this.element.addClass("tele-anomaly-score");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;this.options.speed=this.options.request.score_landing;this.options.direction=this.options.request.score_flow;this.options.query=this.options.request.score_query;this.options.location=this.options.request.score_geo;$.each(["speed","direction","query","location"],function(b,c){var d=
parseInt(100*a.options[c]),e=$("<div>").addClass("tele-anomaly-wrap"),f=$("<div>").addClass("tele-anomaly-icon").addClass("tele-icon-"+c),g=$("<div>").addClass("tele-anomaly-text").html(c.charAt(0).toUpperCase()+c.slice(1)),h=$("<div>").addClass("tele-anomaly-value").html(d+"%");e.append(f).append(g).append(h);25<d&&(f.addClass("active"),g.addClass("active"),h.addClass("active"));a.element.append(e)})}});
$.widget("tele.notifications",{options:{interval:1E4},toShow:[],indexes:!1,showNotifications:function(){$.each(this.toShow,function(a,b){$.pnotify(b)});this.toShow=[];this.count.html(0)},_create:function(){this.element.addClass("tele-notify");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;telepath.ds.get("/notifications/get_syslog",{},function(a){a.items&&0<a.items.length&&$.each(a.items,function(a,b){"CMD"==b.substr(0,3)?eval(b.substr(4)):
console.log("SYSLOG:: "+b)})});telepath.ds.get("/notifications/get_indexes",{time:this.time},function(b){a.indexes?($.each(a.indexes,function(c,d){$.each(b.items,function(b,f){if(c==b&&f>d)switch(c){case "requests":a.indexes[c]=f}})}),a.count&&a.count.html(a.toShow.length)):a.indexes=b.items})}});
$.widget("tele.notifications",{options:{interval:1E4},toShow:[],indexes:!1,showNotifications:function(){$.each(this.toShow,function(a,b){$.pnotify(b)});this.toShow=[];this.count.html(0)},_create:function(){this.element.addClass("tele-notify");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_update:function(){var a=this;telepath.ds.get("/notifications/get_syslog",{},function(a){a.items&&0<a.items.length&&$.each(a.items,function(a,b){"CMD"==b.substr(0,3)?eval(b.substr(4)):
console.log("SYSLOG:: "+b)})});telepath.ds.get("/notifications/get_indexes",{time:this.time},function(b){a.indexes?($.each(a.indexes,function(c,d){$.each(b.items,function(b,f){if(c==b&&f>d)switch(c){case "requests":a.indexes[c]=f}})}),a.count&&a.count.html(a.toShow.length)):a.indexes=b.items})}});
telepath.overlay={resize:function(){var a=$(".tele-overlay").height()-$(".tele-overlay-header").height();0<this.minheight&&this.minheight>a&&(a=this.minheight);$(".tele-overlay-content").height(a);$(".tele-overlay").css({marginTop:-1*($(".tele-overlay").height()/2)})},keydownHandler:function(a){27==a.keyCode&&telepath.overlay.destroy()},destroy:function(){$(".tele-overlay, .tele-overlay-mask").remove();$(document).unbind("keydown",telepath.overlay.keydownHandler)},init:function(a,b,c,d){telepath.overlay.destroy();
this.maskEl=$("<div>").addClass("tele-overlay-mask");this.overlayEl=$("<div>").addClass("tele-overlay").addClass("tele-overlay-"+a);this.iconEl=$("<div>").addClass("tele-overlay-icon").addClass("tele-icon").addClass("tele-icon-"+a);this.headerEl=$("<div>").addClass("tele-overlay-header");this.contentEl=$("<div>").addClass("tele-overlay-content");this.titleEl=$("<div>").addClass("tele-overlay-title").html(b);this.closeEl=$("<a>").attr("href","#").addClass("tele-overlay-close").addClass("tele-icon").addClass("tele-icon-close");
this.minheight="undefined"!==typeof d?d:0;$("body").append(this.maskEl);$("body").append(this.overlayEl);this.overlayEl.append(this.iconEl).append(this.headerEl).append(this.contentEl);this.headerEl.append(this.titleEl).append(this.closeEl);this.closeEl.click(function(){telepath.overlay.destroy()}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});$(document).bind("keydown",telepath.overlay.keydownHandler);c&&(a=$(window).height()-100,0<this.minheight&&this.minheight>
a&&(a=this.minheight),b=$(window).width()-100,$(".tele-overlay").css({height:a,width:b,marginLeft:-1*parseInt(b/2),marginTop:-1*parseInt(a/2)}));$(".tele-overlay").resize(function(){telepath.overlay.resize()});telepath.overlay.resize();$(this.overlayEl).draggable({handle:this.headerEl})}};
$.widget("tele.pagination",{options:{count:0,name:"Alert",current:0,callback:function(){}},_create:function(){this.element.addClass("tele-pagination");this._update()},_setOption:function(a,b){this.options[a]=b;this._update()},_destroy:function(){$(document).unbind("keydown",this.keyDown)},_update:function(){var a=this;telepath.pagination=this;this.element.empty();var b=1<this.options.count?this.options.name+"s":this.options.name,c=this.options.current+1+"/"+this.options.count;this.titleEl=$("<div>").addClass("tele-pagination-title").html(c+
"&nbsp;"+b);this.prevEl=$("<div>").addClass("tele-pagination-prev").addClass("tele-icon").addClass("tele-icon-prev");this.nextEl=$("<div>").addClass("tele-pagination-next").addClass("tele-icon").addClass("tele-icon-next");this.prevEl.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});this.nextEl.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});this.element.append(this.prevEl,this.titleEl,this.nextEl);this.prevEl.click(function(){a.scrollPrev()});
this.nextEl.click(function(){a.scrollNext()});this._constrain();this.titleEl.attr("unselectable","on").css("user-select","none").on("selectstart",!1);$(document).unbind("keydown",this.keyDown);$(document).bind("keydown",this.keyDown)},_constrain:function(){0==this.options.current?this.prevEl.css({visibility:"hidden"}):this.prevEl.css({visibility:"visible"});this.options.current==this.options.count-1?this.nextEl.css({visibility:"hidden"}):this.nextEl.css({visibility:"visible"})},scrollPrev:function(){0<
this.options.current&&(this.options.current--,this._update(),this.options.callback(this.options.current))},scrollNext:function(){this.options.current<this.options.count-1&&(this.options.current++,this._update(),this.options.callback(this.options.current))},keyDown:function(a){"37"==a.keyCode&&telepath.pagination.scrollPrev();"39"==a.keyCode&&telepath.pagination.scrollNext()}});
telepath.config={loaded:!1,init:function(){this.outerContainer=$(".tele-panel-config");this.initTabs()},initTabs:function(){var a=this;$("canvas").remove();this.panelTopBar=$("<div>").addClass("tele-panel-topbar");this.outerContainer.append(this.panelTopBar);this.tabs=[];telepath.access.admin&&this.tabs.push({icon:"accounts",text:"Telepath Users"});(telepath.access.admin||telepath.access.perm.Applications_get)&&this.tabs.push({icon:"applications",text:"Applications"});(telepath.access.admin||telepath.access.perm.Rules_get)&&
this.tabs.push({icon:"rules",text:"Rules"});(telepath.access.admin||telepath.access.perm.Workflow_get)&&this.tabs.push({icon:"actions",text:"Business Actions"});(telepath.access.admin||telepath.access.perm.Config_get)&&this.tabs.push({icon:"system",text:"Advanced"});for(x in this.tabs){var b=this.tabs[x];b.callback=function(b){$(".tele-config-tab .active").removeClass("active");$(".tele-icon",b.element).addClass("active");$(".tele-button-text",b.element).addClass("active");var d=b.options.icon;a.currentPanel=
d;a.container.empty();$("#file-upload").hide();telepath.config[d].container=a.container;telepath.config[d].initLayout=a.initLayout;telepath.config[d].resizeLayout=a.resizeLayout;telepath.config[d].initLayout();telepath.config[d].resizeLayout();telepath.config[d].init();$(window).resize(function(){telepath.config[d].resizeLayout()})};b=$("<div>").btn(b).addClass("tele-config-tab");this.panelTopBar.append(b);this.panelTopBar.append('<div class="tele-navsep"></div>')}$(".tele-navsep:last",this.panelTopBar).remove();
this.container=$("<div>").addClass("tele-panel-config-inner");this.outerContainer.append(this.container);this.container.append(telepath.loader);telepath.config.load()},load:function(a){this.start()},start:function(){var a=this;setTimeout(function(){a.container.empty();$(".tele-button.tele-config-tab:nth-child(1) .tele-button-text").trigger("click")},500)},initLayout:function(){this.barEl=$("<div>").addClass("tele-config-bar").addClass("tele-panel-subtitle");this.barLeft=$("<div>").addClass("tele-config-bar-left");
this.barRight=$("<div>").addClass("tele-config-bar-right");this.contentEl=$("<div>").addClass("tele-config-content");this.contentLeft=$("<div>").addClass("tele-config-content-left");this.contentRight=$("<div>").addClass("tele-config-content-right");this.barEl.append(this.barLeft).append(this.barRight);this.contentEl.append(this.contentLeft).append(this.contentRight);this.container.append(this.barEl).append(this.contentEl)},resizeLayout:function(){this.barEl.css({height:40,width:"100%",background:"#333333"});
var a=$(window).height(),b=$(window).width();1200>b?1024>b?$(".tele-config-tab").css({margin:"5px 10px 0px 10px"}):$(".tele-config-tab").css({margin:"5px 20px 0px 20px"}):$(".tele-config-tab").css({margin:"5px 30px 0px 30px"});$(".tele-body").css({height:a});a=a-$(".tele-header").outerHeight()-$(".tele-panel-topbar").outerHeight()-$(".tele-panel-subtitle").outerHeight();$(".tele-block").height(a-20);$(".tele-block .tele-list").height(a-50);$(".tele-list").mCustomScrollbar("update");this.contentEl.css({height:a});
if(this.contentRight.hasClass("tele-stacked"))this.contentLeft.width(b),this.contentRight.width(b),this.contentRight.css({height:a-this.contentLeft.outerHeight()-20});else{var c=520;this.contentLeft.width(c);this.contentRight.width(b-c-20);this.contentLeft.css({height:a});$(".tele-tree",this.contentLeft).css({height:a}).mCustomScrollbar("update");this.contentRight.css({height:a})}this.barLeft.width(c);this.barRight.width(b-c-20)},startsWith2:function(a,b){if(a.length<b.length)return!1;for(var c=b.length-
1;0<=c&&a[c]===b[c];--c);return 0>c}};
telepath.dashboard={divs:0,data:{items:{}},sort:"count",dir:!1,refreshTimer:!1,refreshInterval:5,reloadFlag:Date.now(),loading:!1,map_mode:!1,getData:function(){this.loading=!0;$(".tele-panel-dashboard-refresh-button").hide();$(".tele-panel-dashboard-refresh").css("paddingRight","+=47px");setTimeout(function(){telepath.dashboard.loading=!1;$(".tele-panel-dashboard-refresh-button").fadeIn();$(".tele-panel-dashboard-refresh").css("paddingRight","-=47px")},5E3);telepath.ds.get("/dashboard/get_map",{},
function(a,b){b&&telepath.dashboard.reloadFlag&&b!=telepath.dashboard.reloadFlag||(telepath.dashboard.map_mode=a.items.map_mode,$(".tele-panel-dashboard .tele-panel-subtitle-right .tele-mini-toggle").toggleFlip({flipped:"traffic"==a.items.map_mode}),telepath.dashboard.data.items.map=a.items.map,telepath.dashboard.map.vMap({data:telepath.dashboard.data.items.map,title:"traffic"==a.items.map_mode?"Traffic over time":"Alerts over time"}),$(window).trigger("resize"))},null,telepath.dashboard.reloadFlag);
telepath.ds.get("/dashboard/get_chart",{},function(a,b){b&&telepath.dashboard.reloadFlag&&b!=telepath.dashboard.reloadFlag||(telepath.dashboard.data.items.chart=a.items.chart,telepath.dashboard.drawGraph(),$(window).trigger("resize"))},null,telepath.dashboard.reloadFlag);telepath.ds.get("/dashboard/get_suspects",{sort:this.sort,dir:this.dir},function(a,b){b&&telepath.dashboard.reloadFlag&&b!=telepath.dashboard.reloadFlag||(telepath.dashboard.data.items.suspects=a.items.suspects,telepath.dashboard.initSuspects(),
$(window).trigger("resize"))},null,telepath.dashboard.reloadFlag);telepath.ds.get("/dashboard/get_alerts",{sort:this.sort,dir:this.dir},function(a,b){b&&telepath.dashboard.reloadFlag&&b!=telepath.dashboard.reloadFlag||(telepath.dashboard.data.items.alerts=a.items.alerts,telepath.dashboard.initAlerts(),$(window).trigger("resize"))},null,telepath.dashboard.reloadFlag);telepath.ds.get("/dashboard/get_cases",{},function(a,b){if(!b||!telepath.dashboard.reloadFlag||b==telepath.dashboard.reloadFlag){var c=
[],d,e=a.items.cases?a.items.cases.length:0;for(d=0;d<e;++d)c.push(a.items.cases[d]);telepath.dashboard.data.items.cases=c;telepath.dashboard.initCases();$(window).trigger("resize")}},null,telepath.dashboard.reloadFlag)},initCases:function(){if(telepath.access.admin||telepath.access.perm.Cases_get)this.divs+=1,this.casesList=$("<div>").addClass("tele-dashboard-block"),$(".tele-panel-dashboard").append(this.casesList),this.casesList.teleList({title:"Recent Cases",titleCallback:function(){$(".tele-nav-cases a").click()},
data:this.data.items.cases,formatter:function(a){return telepath["case"].rowFormatter(a,"dashboard")},callbacks:telepath.listitem.generic.callbacks_case})},initAlerts:function(){if(telepath.access.admin||telepath.access.perm.Alerts_get)this.divs+=1,this.alertsList=$("<div>").addClass("tele-dashboard-block"),$(".tele-panel-dashboard").append(this.alertsList),this.alertsList.teleList({title:"Recent Alerts",titleCallback:function(){$(".tele-nav-alerts a").click()},data:this.data.items.alerts.items,formatter:function(a){a.checkable=
!1;return telepath.alert.rowFormatter(a,"dashboard")}})},initSuspects:function(){if(telepath.access.admin||telepath.access.perm.Suspects_get)this.divs+=1,this.suspectsList=$("<div>").addClass("tele-dashboard-block"),$(".tele-panel-dashboard").append(this.suspectsList),this.suspectsList.teleList({title:"Top Suspects",titleCallback:function(){$(".tele-nav-suspects a").click()},data:this.data.items.suspects.items,formatter:function(a){a.checkable=!1;return telepath.suspects.rowFormatter(a,"dashboard")}})},
refresh:function(a){this.init()},init:function(){var a=this;this.getData();this.resetContainer();this.showFilters();this.resize();0<$(".tele-panel-dashboard").size()&&$(window).resize(function(){a.resize()})},drawGraph:function(){this.graph.flotGraph({data:[{label:"Alerts",data:this.data.items.chart.alerts,color:"#64a5bc"},{label:"Normal",data:this.data.items.chart.sessions,color:"#986da0"},{label:"Cases",data:this.data.items.chart.cases,color:"#ff850b"},{label:"Suspects",data:this.data.items.chart.suspects,
color:"#6ab789"}],options:{legend:{show:!1},series:{lines:{show:!0,fill:!0},points:{show:!0,fillColor:"#446077"}},yaxis:{alignTicksWithAxis:!0,labelWidth:30,ticks:5,color:"#446077",font:{family:"Arial",color:"#cccccc",size:11,weight:"normal"}},selection:{mode:"x"},xaxis:{alignTicksWithAxis:!0,tickColor:"#cccccc",tickLength:7,font:{family:"Arial",color:"#cccccc",size:11,weight:"normal"},mode:"time",timezone:"browser",timeformat:48<(telepath.range.end-telepath.range.start)/3600?"%d/%m/%y":"%d/%m %h:%M:%S"},
grid:{borderColor:"#446077",borderWidth:1,hoverable:!0,clickable:!0},tooltip:!0,tooltipOpts:{content:"%s | date & time: %x | sessions: %y"}},dashboard:!0,title:"Overall Transactions"})},resetContainer:function(a){this.divs=0;var b=this;$(".tele-panel-dashboard .tele-panel-subtitle-right .tele-mini-toggle").toggleFlip({flipped:"traffic"==telepath.dashboard.data.items.map});var c=$(".tele-panel-dashboard");c.empty();c.append('<div class="tele-panel-topbar"><div class="tele-panel-title">Dashboard</div><div class="tele-panel-topbar-right"></div></div>');
if(a)c.append(telepath.loader);else{c.append('<div class="tele-panel-subtitle"><div class="tele-panel-subtitle-text">Traffic and Alerts Trends</div><div class="tele-panel-subtitle-right"></div></div>');a=$("<div>").toggleFlip({left_value:"Alerts",right_value:"Traffic",flipped:"traffic"==b.map_mode,flip:function(a,c){b.map.empty();b.map.append(telepath.loader);a?telepath.ds.get("/dashboard",{mode:"map_traffic"},function(a){telepath.dashboard.data.items.map=a.items.traffic;b.map.vMap({data:a.items.traffic,
title:"Traffic over time"})}):telepath.ds.get("/dashboard",{mode:"map_alerts"},function(a){telepath.dashboard.data.items.map=a.items.map;b.map.vMap({data:a.items.map,title:"Alerts over time"})})}});var d=$("<div>").toggleFlip({left_value:"Static",right_value:"Realtime",flip:function(a,c){a?(b.graph.hide(),b.graph_realtime.show(),telepath.realtime.start(b.graph_realtime),$(".tele-panel-subtitle-text").html("Realtime Monitor")):(b.graph.show(),b.graph_realtime.hide(),telepath.realtime.stop(),$(".tele-panel-subtitle-text").html("Traffic and Alerts Trends"))}}).hide();
$(".tele-panel-dashboard .tele-panel-subtitle-right").append(d);$(".tele-panel-dashboard .tele-panel-subtitle-right").append(a);a=$("<div>").css("background-color","#304f68").css("width","100%");d=$("<div>").css("clear","both");this.map=$("<div>");this.graph=$("<div>");a.append(this.map);a.append(this.graph);a.append(d);c.append(a);this.graph_realtime=$("<div>").addClass("tele-graph-realtime");c.append(this.graph_realtime)}},resize:function(){if(0!=$(".tele-panel-dashboard").children().size()){var a=
$(window).width(),b=parseInt(100/this.divs);1025>a?($(".tele-map").width("100%"),$(".tele-graph").width("100%"),$(".tele-dashboard-block").width("100%")):($(".tele-map").width("33%"),$(".tele-graph").width("67%"),$(".tele-dashboard-block").width(b+"%"))}},updateRefreshInterval:function(a){a&&(this.refreshInterval=a);this.cmdRefreshValue.html(this.refreshInterval+"m");this.refreshTimer&&clearInterval(this.refreshTimer);this.refreshTimer=setInterval(function(){telepath.dashboard.refresh()},6E4*this.refreshInterval)},
showFilters:function(){var a=this,b=$(".tele-panel-dashboard .tele-panel-topbar-right");b.empty();var c=$("<div>").appSelect({callback:function(a){$(".tele-icon-application",c).removeClass("tele-icon-application").addClass("tele-icon-loader");telepath.dashboard.refresh(function(){$(".tele-icon-loader",c).addClass("tele-icon-application").removeClass("tele-icon-loader")})}}),d=$("<div>").addClass("tele-panel-dashboard-refresh"),e=$("<a>").attr("href","#").addClass("tele-panel-dashboard-refresh-text").html("Refresh Rate");
this.cmdRefreshValue=$("<a>").attr("href","#").addClass("tele-panel-dashboard-refresh-value").html(this.refreshInterval+"m");var f=$("<a>").attr("href","#").addClass("tele-panel-dashboard-refresh-button").html("&nbsp;");d.append(e).append(this.cmdRefreshValue).append(f);f.click(function(){if(!telepath.dashboard.loading){$(this).addClass("loader");var a=this;telepath.dashboard.refresh(function(){$(a).removeClass("loader")})}});var e=$("<div>").daterange({start:telepath.range.start,end:telepath.range.end,
change:function(a,b){telepath.dashboard.reloadFlag=Date.now();f.addClass("loader");telepath.dashboard.refresh(function(){f.removeClass("loader")})}}),g=$("<div>").radios({title:"Sort By",items:[{id:"date",icon:"time",tip:"Time"},{id:"count",icon:"bars",tip:"Count"}],selected:this.sort,callback:function(b,c){a.sort==c&&(a.dir=!a.dir);a.sort=c;a.refresh()}});b.append(g).append('<div class="tele-navsep"></div>').append(e).append('<div class="tele-navsep"></div>').append(c).append('<div class="tele-navsep"></div>').append(d);
$(".tele-panel-dashboard-refresh-value").click(function(){$("body").append('<div class="tele-popup tele-refreshrate-popup"><input class="tele-refreshrate-slider" /></div>');if("block"==$(".tele-refreshrate-popup").css("display"))$(".tele-refreshrate-popup").fadeOut("fast",function(){$(this).remove()});else{var b=$(this).offset().top+$(this).height()+20,c=$(this).offset().left+$(this).width()/2-$(".tele-daterange-popup").width()/2-150;$(".tele-refreshrate-popup").css({top:b,left:c});$(".tele-refreshrate-popup").fadeIn();
a.refresh_slider=$(".tele-refreshrate-slider").slider({orientation:"horizontal",max:60,min:1,value:parseInt(telepath.dashboard.refreshInterval)}).on("slide",function(a){a=telepath.dashboard.refresh_slider.val();telepath.dashboard.updateRefreshInterval(a)})}})}};
telepath.realtime={container:!1,timer:!1,count:0,options:{legend:{show:!0,color:"yellow",labelBoxBorderColor:"white",position:"sw",backgroundColor:"white",backgroundOpacity:1,margin:10},series:{lines:{show:!0,fill:!0},points:{show:!0,fillColor:"#446077"},color:"yellow"},xaxis:{mode:"time",tickFormatter:function(a,b){var c=new Date(a),d=10>c.getHours()?"0"+c.getHours():c.getHours(),e=10>c.getMinutes()?"0"+c.getMinutes():c.getMinutes(),c=10>c.getSeconds()?"0"+c.getSeconds():c.getSeconds();return d+
":"+e+":"+c},axisLabel:"Time",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:10},yaxes:[{axisLabel:"Dropped",axisLabelUseCanvas:!0,axisLabelFontColor:"#cecece",font:{family:"Arial",color:"white",size:11,weight:"normal"},axisLabelPadding:6,min:0},{position:"right",axisLabel:"Requests",axisLabelUseCanvas:!0,axisLabelFontColor:"#cecece",font:{family:"Arial",color:"white",size:11,weight:"normal"},axisLabelPadding:6},{position:"right",axisLabel:"Packets",
axisLabelUseCanvas:!0,axisLabelFontColor:"#cecece",font:{family:"Arial",color:"white",size:11,weight:"normal"},axisLabelPadding:14}],grid:{borderColor:"#446077",borderWidth:1}},offsets:{init:!1,packets:0,loss:0,requests:0},start:function(a){this.container=a;a=(new Date).getTime()-6E4;this.data={packets:[],loss:[],requests:[]};for(var b=0;60>b;b++){var c=[a+=1E3,0];this.data.packets.push(c);this.data.loss.push(c);this.data.requests.push(c)}a=[{label:"Packets:",data:this.data.packets,lines:{fill:!0,
lineWidth:1.2},color:"#6ab789"},{label:"Dropped:",data:this.data.loss,lines:{lineWidth:1.2},color:"#64a5bc",yaxis:3},{label:"Requests:",data:this.data.requests,color:"#986da0",bars:{show:!0},yaxis:2}];$.plot($(this.container),a,this.options);this.timer=setInterval(this.getData,1E3)},stop:function(){clearInterval(this.timer);this.container.empty()},tick:function(){telepath.realtime.count+=1},getData:function(){$.ajaxSetup({cache:!1});$.ajax({url:telepath.controllerPath+"/realtime/index",dataType:"json",
success:function(a){a["capture.kernel_packets"]=parseInt(a["capture.kernel_packets"]);a["capture.kernel_drops"]=parseInt(a["capture.kernel_drops"]);if(telepath.realtime.offsets.init){telepath.realtime.data.packets.shift();telepath.realtime.data.loss.shift();telepath.realtime.data.requests.shift();var b=(new Date).getTime();telepath.realtime.data.packets.push([b,a["capture.kernel_packets"]-telepath.realtime.offsets.packets]);telepath.realtime.data.loss.push([b,a["capture.kernel_drops"]-telepath.realtime.offsets.loss]);
telepath.realtime.data.requests.push([b,a.cmd_set-telepath.realtime.offsets.requests]);b=[{label:"Dropped",data:telepath.realtime.data.loss,lines:{lineWidth:1.2},color:"#640000"},{label:"Packets",data:telepath.realtime.data.packets,lines:{fill:!0,lineWidth:1.2},color:"#986da0",yaxis:3},{label:"Requests",data:telepath.realtime.data.requests,color:"#6ab789",yaxis:2}];$.plot($(telepath.realtime.container),b,telepath.realtime.options);telepath.realtime.offsets.packets=a["capture.kernel_packets"];telepath.realtime.offsets.loss=
a["capture.kernel_drops"];telepath.realtime.offsets.requests=a.cmd_set}else telepath.realtime.offsets.packets=a["capture.kernel_packets"],telepath.realtime.offsets.loss=a["capture.kernel_drops"],telepath.realtime.offsets.requests=a.cmd_set,telepath.realtime.offsets.init=!0},error:function(){}});$.ajaxSetup({cache:!0})}};
telepath["case"]={rowFormatter:function(a,b){a._source&&(a=a._source);a.data=a.case_data.details;var c=[];$.each(a.data,function(a,b){c.push({key:b.type,value:telepath.formatConditionBrief(!1,b)})});a.checkable||(a.checkable=!1);a.favorites||(a.favorites=!1,a.favorite=!1);return"dashboard"==b?{details:c,dataID:a.name,icon:"case",title:a.name,count:a.count,time:a.last_time,favorite:a.favorite}:{checkable:a.checkable,favorites:a.favorites,favorite:a.favorite,dataID:a.name,icon:"case",title:a.name,count:a.count,
updating:a.case_data.updating,details:c,time:a.last_time}}};
telepath.caseOverlay={addCase:function(){this.initUI({id:"new",case_data:{case_name:"New Case",details:[]}})},editCase:function(a){this.initUI(a)},initUI:function(a){var b=this;this.data=a;telepath.overlay.init("case-edit",a.case_data.case_name);$(".tele-overlay").height(860).trigger("resize");var c=$("<div>").teleInput({label:"Name",value:"new"==a.id?"":a.case_data.case_name,disabled:"new"==a.id?!1:!0});telepath.overlay.contentEl.append(c);var d=$("<div>").addClass("tele-title-1").text("Traffic matching following conditions will be aggregated into this case");
telepath.overlay.contentEl.append(d);var e=$("<div>").conditionList({data:a.case_data.details});telepath.overlay.contentEl.append(e);a=$("<div>").addClass("tele-button-container");var d=$('<a href="#" class="tele-button tele-button-apply">Save</a>'),f=$('<a href="#" class="tele-button tele-button-cancel">Cancel</a>');a.append(d).append(f);telepath.overlay.contentEl.append(a);d.click(function(){var a=e.data("tele-conditionList").getJSON(),d=c.data("tele-teleInput").input.val();c.removeClass("error");
0==d.length||32<d.length?c.addClass("error"):0==a.length?telepath.dialog({title:"Case Editor",msg:"Must have at least one condition"}):($(".tele-icon-case-edit").append(telepath.loader).css({backgroundColor:"#555"}),"new"==b.data.id?telepath.ds.get("/cases/add_case",{name:d,case_data:JSON.stringify(a)},function(a){a.items.existing?telepath.dialog({title:"Case Editor",msg:"Already have a case with this name"}):(telepath.overlay.destroy(),telepath.cases.refresh(function(){}),telepath.ds.get("/cases/flag_requests_by_cases",
{"case":[d],range:!1,method:"add"},function(a){telepath.cases.refresh(function(){})}))}):telepath.ds.get("/cases/set_case",{name:d,case_data:JSON.stringify(a)},function(a){a.existing?telepath.dialog({title:"Case Editor",msg:"Already have a case with this name"}):(telepath.overlay.destroy(),telepath.cases.refresh(function(){}),telepath.ds.get("/cases/flag_requests_by_cases",{"case":[d],range:!1,method:"update"},function(a){telepath.cases.refresh(function(){})}))}))});f.click(function(){telepath.overlay.destroy()})}};
telepath.casePanel={data:{},sort:"date",dir:!1,init:function(a){$(".tele-panel-case").remove();this.container=$("<div>").addClass("tele-panel-case");$(".tele-panel-cases").append(this.container);$(".tele-panel-cases-inner").hide();this.panelTopBar=$("<div>").addClass("tele-panel-topbar");this.panelTitle=$("<div>").addClass("tele-panel-title");this.panelTopBar.append(this.panelTitle);this.panelTitle.html("Loading Case # "+a);this.container.append(this.panelTopBar);this.container.append('<img class="loader" src="img/loader.gif">');
this.getData(a)},refresh:function(a){telepath.ds.get("/cases/get_case",{start:telepath.range.start,end:telepath.range.end,apps:telepath.appFilter,sort:this.sort,dir:this.dir,cid:this.caseID},function(b){telepath.casePanel.loadData(b);"function"==typeof a&&a()})},getData:function(a){this.caseID=a;this.refresh()},loadData:function(a){var b=this;this.data=a;$(".loader",this.container).remove();$(".tele-case-graph, .tele-wrapper, .tele-panel-subtitle, .tele-infoblock, .mCustomScrollbar",this.container).remove();
this.panelTopBar.empty();this.panelTitle=$("<div>").addClass("tele-panel-title");this.panelTopBar.append(this.panelTitle);this.panelTitle.html(this.data["case"].case_data.case_name+" | "+this.data.count+" Sessions");this.favEl=$("<a>").cb({icon:"favorites",checked:"1"==a["case"].favorite,callback:function(a){telepath.ds.get("/cases/set_case_fav",{cid:b.caseID,favorite:a.options.checked},function(a){})}});this.panelTopBar.prepend(this.favEl);this.caseDesc=$("<div>").addClass("tele-panel-description");
$.each(a["case"].case_data.details,function(a,c){var d=$("<span>").html(c.type+":&nbsp;"),e=$("<span>").html(telepath.formatConditionBrief(!1,c));b.caseDesc.append(d).append(e).append("<span>&nbsp;|&nbsp;</span>")});$("span:last",b.caseDesc).remove();this.goBack=$("<a>").attr("href","#").addClass("tele-panel-case-close").html("|&nbsp;Back to all cases");this.panelTopBar.append(this.goBack);this.editCase=$("<div>").btn({icon:"caseConfig",text:"Edit Case",callback:function(){telepath.caseOverlay.editCase(b.data["case"])}});
this.panelTopBar.append(this.editCase);a=$("<div>").radios({title:"Sort By",items:[{id:"date",icon:"time",tip:"Time"},{id:"count",icon:"bars",tip:"Count"}],selected:this.sort,callback:function(a,c){b.sort==c&&(b.dir=!b.dir);b.sort=c;b.refresh()}});this.panelTopBar.append('<div class="tele-navsep"></div>');this.panelTopBar.append(a);this.panelTopBar.append(this.caseDesc);this.goBack.click(function(){$(".tele-panel-case").remove();telepath.cases.init()});var c=[{label:"random",data:this.data.chart,
color:"#5191D1"}];a=$("<div>").addClass("tele-case-graph");var d=$("<div>").daterange({start:telepath.range.start,end:telepath.range.end,change:function(a,c){telepath.range.start=a;telepath.range.end=c;b.refresh()}}),e=$("<div>").appSelect({callback:function(a){$(".tele-icon-application",e).removeClass("tele-icon-application").addClass("tele-icon-loader");telepath.cases.refresh(function(){$(".tele-icon-loader",e).removeClass("tele-icon-loader").addClass("tele-icon-application")})}});this.container.append(a);
a.flotGraph({data:c,options:{legend:{show:!1},series:{lines:{show:!0,fill:!0},points:{show:!0,fillColor:"#446077"}},yaxis:{alignTicksWithAxis:!0,labelWidth:30,ticks:5,color:"#446077",font:{family:"Arial",color:"#cccccc",size:11,weight:"normal"}},selection:{mode:"x"},xaxis:{alignTicksWithAxis:!0,tickColor:"#cccccc",tickLength:7,font:{family:"Arial",color:"#cccccc",size:11,weight:"normal"},mode:"time",timezone:"browser",timeformat:"%d/%m"},grid:{borderColor:"#446077",borderWidth:1}}});c=$("<div>").addClass("tele-graph-title").html("Case Sessions");
a.prepend(c).prepend(d).prepend('<div class="tele-navsep"></div>').prepend(e);this.panelSubBar=$("<div>").addClass("tele-panel-subtitle");this.container.append(this.panelSubBar);a=$("<a>").cb({callback:function(a){$(".tele-panel-cases .tele-list li.tele-listitem").listitem("option","checked",a.options.checked)}});this.panelSubBar.append(a);this.list=$("<div>").addClass("tele-case-alerts-block");this.listWrap=$("<div>").addClass("tele-wrapper").append(this.list).css({display:"inline-block"}).width("65%");
this.container.append(this.listWrap);this.list.teleList({data:this.data.items,formatter:function(a){return b.formatter(a)}});this.similarsList=$("<div>").addClass("tele-case-similar-block");this.similarsListWrap=$("<div>").addClass("tele-wrapper").append(this.similarsList).css({display:"inline-block"}).width("35%");this.container.append(this.similarsListWrap);this.similarsList.teleList({title:"Related Sessions",data:this.data.similars.items,formatter:function(a){return b.formatter(a)}});$(window).resize(function(){b._resize()})},
formatter:function(a){var b={};b.title=""!=a.title?a.title:a.display_path;b.progbar=!0;b.time=a.date;b.timeFormat="h:i A";b.offset=20;b.icon="case";b.count=a.count;b.itemID=a.sid;b.details=[{key:"country",value:a.country},{key:"IP",value:a.ip_orig},{key:"city",value:a.city},{key:"user",value:a.user_id},{key:"host",value:grabNames(a.host)},{key:"alerts",value:a.alerts_count},{key:"user",value:a.user}];b.raw=a;var c=0<a.alert_count;b.progbarValue=parseInt(a.avg_score);!1!==c?(b.icon="alert",b.description=
c.name,b.progbarValue=c.numeric_score):85<a.avg_score&&(b.icon="suspect_red");return b},_resize:function(){var a=$(window).height();$(".tele-body").css({height:a});a=a-$(".tele-header").outerHeight()-$(".tele-panel-topbar").outerHeight()-$(".tele-case-graph").outerHeight()-$(".tele-panel-subtitle").outerHeight();$(".tele-panel-case .tele-block").height(a-40);$(".tele-panel-case .tele-block .tele-list").height(a-70);$(".tele-panel-case .tele-case-alerts-block .tele-list").mCustomScrollbar("update");
$(".tele-panel-case .tele-case-similar-block .tele-list").mCustomScrollbar("update")}};
telepath.cases={sort:"date",dir:!1,data:[],searchString:"",init:function(){this.drawUI();this.refresh()},refresh:function(a){var b=this;telepath.ds.get("/cases/get_cases",{search:this.searchString,sort:this.sort,dir:this.dir},function(c){var d=[],e;for(e=0;e<c.items.length;++e)c.items[e].name&&d.push(c.items[e]);b.setData(d);"function"==typeof a&&a()})},setData:function(a){this.container=$(".tele-panel-cases .tele-panel-cases-inner");var b=this;this.data=a;$(".tele-block",this.container).remove();
this.list=$("<div>");this.container.append(this.list);this.list.teleList({data:this.data,formatter:function(a){a.checkable=!0;a.favorites=!0;a.favorite="1"==a.case_data.favorite;return telepath["case"].rowFormatter(a)},callbacks:telepath.listitem.generic.callbacks_case});this.panelTitle.html(this.data.length+" Cases");setTimeout(function(){b._resize()},0);$(window).resize(function(){b._resize()})},_resize:function(){if(0!=$(".tele-panel-cases").children().size()){var a=$(window).height();$(".tele-body").css({height:a});
a=a-$(".tele-header").outerHeight()-$(".tele-panel-topbar").outerHeight()-$(".tele-panel-subtitle").outerHeight();$(".tele-panel-cases .tele-block").height(a-20);$(".tele-panel-cases .tele-block .tele-list").height(a-50);$(".tele-panel-cases .tele-list").mCustomScrollbar("update")}},drawUI:function(){var a=this;$(".tele-panel-cases").empty();var b=$("<div>").addClass("tele-panel-cases-inner");$(".tele-panel-cases").append(b);var c=$("<div>").addClass("tele-panel-topbar"),d=$("<div>").addClass("tele-panel-subtitle"),
e=$("<div>").addClass("tele-panel-title"),f=$("<div>").addClass("tele-panel-topbar-right");c.append(e).append(f);this.panelTitle=e;e=$("<div>").btn({icon:"plus",text:"New Case",callback:function(){telepath.access.admin||telepath.access.perm.Cases_add?telepath.caseOverlay.addCase():telepath.dialog({msg:"Access denied. No permissions to add new Case group."})}});this.panelTitle.after(e);b.append(c);b.append(d);b=$("<a>").teleCheckbox({callback:function(b){a.list&&a.list.data("tele-teleList").toggleAll(b.options.checked)}});
d.append(b);b=$("<div>").btn({icon:"delete",text:"Delete",callback:function(){if(a.list){var b=a.list.data("tele-teleList").getSelected();0==b.length?telepath.dialog({msg:"No Case selected."}):telepath.access.admin||telepath.access.perm.Cases_del?telepath.dialog({type:"dialog",title:"Confirm",msg:"Remove "+b.length+" case(s)?",callback:function(){telepath.ds.get("/cases/del_cases",{cids:b},function(c){a.setData(c.items);telepath.ds.get("/cases/flag_requests_by_cases",{"case":b,range:!1,method:"delete",
repeat:!1},function(a){})})}}):telepath.dialog({msg:"Access denied. No permissions to delete Cases."})}}});d.append(b);var d=$("<div>").radios({title:"Sort By",items:[{id:"date",icon:"time",tip:"Time"},{id:"name",icon:"arrow",tip:"ABC"},{id:"count",icon:"bars",tip:"Count"}],selected:this.sort,callback:function(b,c){a.sort==c&&(a.dir=!a.dir);a.sort=c;a.refresh()}}),b=$(".tele-panel-cases .tele-panel-topbar-right"),c=$("<div>").daterange({start:telepath.range.start,end:telepath.range.end,change:function(a,
b){telepath.range.start=a;telepath.range.end=b;telepath.cases.refresh(function(){})}}),g=$("<div>").appSelect({callback:function(a){$(".tele-icon-application",g).removeClass("tele-icon-application").addClass("tele-icon-loader");telepath.cases.refresh(function(){$(".tele-icon-loader",g).removeClass("tele-icon-loader").addClass("tele-icon-application")})}});b.append(d).append('<div class="tele-navsep"></div>').append(c).append('<div class="tele-navsep"></div>').append(g)}};
telepath.alert={grabNames:function(a){var b="";$.each(a,function(a,d){b=b+d.key+", "});0<b.length&&(b=b.substr(0,b.length-2));return b},rowFormatter:function(a,b){a._source&&(a=a._source);if("dashboard"==b){var c=""!=a.user?{key:"user",value:a.user}:{key:"IP",value:a.ip_orig};return{raw:a,itemID:a.sid,icon:"alert",checkable:a.checkable,count:a.alerts_count,progbar:!0,progbarValue:a.ip_score,time:a.date,title:telepath.alert.grabNames(a.alerts_names),details:[c,{key:"country",value:a.country},{key:"host",
value:telepath.alert.grabNames(a.host)}]}}return{raw:a,itemID:a.sid,icon:"alert",checkable:a.checkable,count:a.alerts_count,progbar:!0,progbarValue:a.ip_score,time:a.date,title:telepath.alert.grabNames(a.alerts_names),details:[{key:"IP",value:a.ip_orig},{key:"country",value:a.country},{key:"city",value:a.city},{key:"host",value:telepath.alert.grabNames(a.host)},{key:"actions",value:a.actions_count},{key:"cases",value:a.cases_count},{key:"user",value:a.user}]}},filters:{H:!0,P:!0,G:!0,J:!0,X:!0},getSeverity:function(a){var b=
$("<div>").addClass("tele-severity");0<a&&70>a&&b.addClass("tele-severity-low").text("Low");70<=a&&90>a&&b.addClass("tele-severity-medium").text("Medium");90<=a&&100>a&&b.addClass("tele-severity-critical").text("Critical");b.append("&nbsp;<span>("+a+")</span>");return b},lookupAction:function(a){for(x in telepath.actionList)if(telepath.actionList[x].id=a)return telepath.actionList[x].name;return"Browsing"},lookupRequest:function(a){for(x in this.data.requests){var b=this.data.requests[x];if(b.RID==
a)return b}return!1},lookupAlert:function(a){for(x in this.data.alerts){var b=this.data.alerts[x];if(b.RID==a)return b}return this.data.alerts[0]},data:[],updateSelected:function(){$(".selected",this.actionsContainer).removeClass("selected");var a=$("li:nth-child("+(this.selectedIndex+1)+")",this.actionsContainer);$(".tele-listitem-inner",a).addClass("selected");a=a.listitem("option","dataID");this.expandRequest(a);$(this.actionsContainer).mCustomScrollbar("scrollTo","li:nth-child("+(this.selectedIndex+
1)+")")},scrollUp:function(){0<this.selectedIndex&&this.selectedIndex--;this.updateSelected()},scrollDown:function(){this.selectedIndex<this.data.requests.length&&this.selectedIndex++;this.updateSelected()},keyDown:function(a){"38"==a.keyCode&&(a.preventDefault(),telepath.alert.scrollUp());"40"==a.keyCode&&(a.preventDefault(),telepath.alert.scrollDown())},destroy:function(){$(document).unbind("overlay_destroy",telepath.alert.destroy);$(document).unbind("keydown",telepath.alert.keyDown)},initTools:function(){this.archiveAlert=
$("<div>").btn({icon:"archive",text:"Archive Alert",callback:function(){}});this.overlay.headerEl.append(this.archiveAlert);this.overlay.headerEl.append('<div class="tele-navsep"></div>');this.moveTo=$("<div>").dropdown({icon:"moveTo",value:"Move To",callback:function(){}});this.overlay.headerEl.append(this.moveTo);this.overlay.headerEl.append('<div class="tele-navsep"></div>');this.editRule=$("<div>").btn({icon:"edit",text:"Edit Rule",callback:function(){}});this.overlay.headerEl.append(this.editRule)},
initSingle:function(a){$(document).unbind("keydown",telepath.alert.keyDown);$(document).bind("keydown",telepath.alert.keyDown);$(document).bind("overlay_destroy",telepath.alert.destroy);telepath.overlay.init("alerts","Loading ...");this.overlay=telepath.overlay;this.initTools();telepath.ds.get("/alerts/get_alert",{RID:a},function(a){telepath.alert.showAlert(a.items)})},init:function(a,b){$(document).unbind("keydown",telepath.alert.keyDown);$(document).bind("keydown",telepath.alert.keyDown);$(document).bind("overlay_destroy",
telepath.alert.destroy);telepath.overlay.init("alerts","Loading ...");this.overlay=telepath.overlay;this.loadAlert(a);this.pagination=$("<div>").pagination({current:b,count:telepath.alerts.data.alerts.length,name:"Alert",callback:function(a){telepath.alert.loadAlert(telepath.alerts.data.alerts[a].id)}});this.overlay.headerEl.append(this.pagination);this.overlay.headerEl.append('<div class="tele-navsep"></div>');this.initTools()},loadAlert:function(a){this.alertID=a;this.overlay.titleEl.html("Loading alert #"+
this.alertID);this.overlay.contentEl.empty().append(telepath.loader);var b=!1;for(x in telepath.alerts.data.alerts)if(telepath.alerts.data.alerts[x].id==a){b=telepath.alerts.data.alerts[x];break}b&&telepath.ds.get("/alerts/get_alert",{SID:b.SID,epoch:b.date},function(a){telepath.alert.showAlert(a.items)})},formatData:function(a){var b=this,c={};c.title=""!=a.title?a.title:a.display_path;c.progbar=!0;c.time=a.date;c.timeFormat="h:i A";c.offset=20;c.icon="suspect";c.dataID=a.sid;$.each(telepath.alert.data.alerts,
function(b,e){e.RID==a.RID&&(c.icon="suspect_red")});c.progbarValue=a.ip_score;c.callback=function(a,c){$(".selected",b.actionsContainer).removeClass("selected");$(".tele-listitem-inner",a.element).addClass("selected");b.expandRequest(a.options.dataID)};return c},showAlert:function(a){var b=this.overlay.contentEl;b.empty();this.selectedIndex=0;telepath.alert.data=a;this.alertLeft=$("<div>").addClass("tele-alert-left");this.alertMid=$("<div>").addClass("tele-alert-mid");this.alertRight=$("<div>").addClass("tele-alert-right");
b.append(this.alertLeft).append(this.alertMid).append(this.alertRight);this.overlay.titleEl.html("Alert #"+this.alertID);var c={All:a.requests.length,Alerts:a.alerts.length,Actions:0};$.each(a.requests,function(a,b){b.business_id&&b.business_status&&"2"==b.business_status&&c.Actions++});var d=$("<div>").addClass("tele-alert-stats");$.each(c,function(a,b){var c=$("<div>").addClass("tele-alert-stat"),e=$("<div>").addClass("tele-alert-stat-key").html(a),f=$("<div>").addClass("tele-alert-stat-value").html(b);
c.append(e).append(f);d.append(c)});this.alertLeft.append(d);var b=$("<div>").addClass("tele-alert-duration"),e=$("<div>").addClass("tele-alert-duration-start"),f=$("<div>").addClass("tele-alert-duration-lbl").html("Started:"),g=$("<div>").addClass("tele-alert-duration-val").html(date_format("d/m/y | h:i A",a.requests[0].date)),h=$("<div>").addClass("tele-alert-duration-end"),k=$("<div>").addClass("tele-alert-duration-lbl").html("Ended:"),l=$("<div>").addClass("tele-alert-duration-val").html(date_format("d/m/y | h:i A",
a.requests[a.requests.length-1].date));e.append(f).append(g);h.append(k).append(l);b.append(e).append(h);this.alertLeft.append(b);this.actionsContainer=$("<div>").addClass("tele-alert-actions");this.alertLeft.append(this.actionsContainer);this.requestDetails=$("<div>").addClass("tele-alert-details").addClass("tele-popup");this.alertMid.prepend(this.requestDetails);this.lastAction=-1;this.printed=0;for(x in a.requests)b=a.requests[x],b.business_id!=this.lastAction&&(this.actionContainer=$("<div>").addClass("tele-alert-action"),
this.actionContainerIcon=$("<div>").addClass("tele-alert-action-icon").addClass("tele-icon").addClass("tele-icon-suspect"),this.actionContainerTitle=$("<div>").addClass("tele-alert-action-title").text(this.lookupAction(b.business_id)),this.newList=$('<ul class="tele-list">'),this.actionContainer.append(this.actionContainerIcon).append(this.actionContainerTitle).append(this.newList),$(this.actionsContainer).append(this.actionContainer),this.lastAction=b.business_id),b=this.formatData(b),e=$("<li>").attr("id",
"alert-item-"+x),this.newList.append(e),e.listitem(b),this.printed++;$(this.actionsContainer).mCustomScrollbar({scrollButtons:{enable:!1},scrollInertia:150,callbacks:{onTotalScrollOffset:50,onTotalScroll:function(){}}});this.updateSelected()},expandRequest:function(a){var b=this;this.requestDetails.empty();this.requestDetails.append(a);this.requestDetails.append(telepath.loader);var c=this.lookupRequest(a);c&&(this.requestInfo=c,telepath.ds.get("/similarities/",{param_type:"request",param_id:a},function(a){b.similaritiesList=
$("<div>");b.similaritiesList.teleList({title:"Similar Requests",titleCallback:function(){},data:a.items,formatter:function(a){return{icon:"suspect",time:a.date,itemID:a.RID,progbar:!0,progbarValue:parseInt(100*a.ip_score),details:[{key:"country",value:a.country},{key:"IP",value:a.IP}]}},callbacks:{click:function(a){},hover_in:function(a,b){},hover_out:function(a,b){}}}).appendTo(b.requestDetails)}),telepath.ds.get("/alerts/get_session_flow_params",{sid:c.SID,rids:a,epoch:c.date},function(a){b.expandRequestData(a)}))},
expandRequestData:function(a){$(".loader",this.requestDetails).remove();this.requestData=a.items;this.printParams()},printParams:function(a){a=this.requestDetails;a.empty();this.printParamsFilters(a);this.printAlertDetails(a);this.printParamsTable(a);this.printAlertInfo(this.alertRight)},printParamsFilters:function(a){var b=this;this.filtersContainer=$("<div>").addClass("tele-alert-filters");a.append(this.filtersContainer);$.each([{type:"H",label:"Headers"},{type:"G",label:"Get"},{type:"P",label:"Post"},
{type:"J",label:"Json"},{type:"X",label:"XML"}],function(a,d){var e=$("<div>").teleCheckbox({checked:telepath.alert.filters[d.type],label:d.label,inputFirst:!0,callback:function(a){telepath.alert.filters[d.type]=a.options.checked;b.printParams()}});b.filtersContainer.append(e)})},printAlertDetails:function(a){this.alertDetails=$("<div>").addClass("tele-alert-details-info");a.append(this.alertDetails);this.alertDetailsTitle=$("<div>").addClass("tele-alert-details-info-title").text(this.lookupAction(this.requestInfo.business_id));
this.alertDetailsTimeWrap=$("<div>").addClass("tele-alert-details-info-time-wrap");this.alertDetailsTimeLabel=$("<div>").addClass("tele-alert-details-info-time-label").text("Request time:");this.alertDetailsTime=$("<div>").addClass("tele-alert-details-info-time").text(date_format("m/d/y | H:i:s",this.requestInfo.date));this.alertDetailsTimeWrap.append(this.alertDetailsTimeLabel).append(this.alertDetailsTime);a=parseInt(100*this.requestData.avg_score)+"%";this.alertSeverityWrap=$("<div>").addClass("tele-alert-severity-wrap");
this.alertSeverityLabel=$("<div>").addClass("tele-alert-severity-label").text("Severity");this.alertSeverityPercent=$("<div>").addClass("tele-alert-severity-percent").text(a);this.alertSeverityProgBar=$("<div>").addClass("tele-alert-severity-progbar");this.alertSeverityProgValue=$("<div>").addClass("tele-alert-severity-progbar-value").css({width:a});this.alertSeverityWrap.append(this.alertSeverityLabel).append(this.alertSeverityPercent).append(this.alertSeverityProgBar);this.alertSeverityProgBar.append(this.alertSeverityProgValue);
this.alertDetails.append(this.alertSeverityWrap).append(this.alertDetailsTitle).append(this.alertDetailsTimeWrap)},printAlertInfo:function(a){function b(a,b){var c=$("<tr>"),d=$("<td>").html(a).addClass("tele-alert-info-key"),k=$("<td>").html(b).addClass("tele-alert-info-value");c.append(d).append(k);return c}a.empty();var c=this.lookupAlert(this.requestInfo.RID);this.alertInfo=$("<div>").addClass("tele-alert-info");this.alertInfoTitle=$("<div>").addClass("tele-alert-info-title").text("Alert Info");
this.alertInfoLabel=$("<div>").addClass("tele-alert-info-label").text("Description:");this.alertInfoDesc=$("<div>").addClass("tele-alert-info-description").text(c.description);var d=this.alertInfoTable=$("<div>").addClass("tele-alert-info-table");d.append(b("Time:",date_format("m/d/y | H:i:s",c.date)));d.append(b("Severity:",this.getSeverity(c.numeric_score)));d.append(b("Applications:",this.requestInfo.app_domain));d.append(b("IP:",c.ip));d.append(b("Location:",'<span class="flag flag-'+this.requestInfo.country+
'"></span><span class="tele-country">'+telepath.countries.a2n(this.requestInfo.country)+"</span>"));c.user&&""!=c.user&&d.append(b("User:",c.user));this.alertInfo.append(this.alertInfoTitle).append(this.alertInfoLabel).append(this.alertInfoDesc).append(this.alertInfoTable);a.append(this.alertInfo)},printParamsTable:function(a){var b=$("<div>").addClass("tele-alert-params-table-wrap"),c=$("<table>").addClass("tele-alert-params-table");$.each(this.requestData.params,function(a,b){if(telepath.alert.filters[b.att_source]){var f=
$("<tr>"),g=$("<td>").addClass("tele-param-name").html(b.att_name),h=$("<td>").addClass("tele-param-data").html(b.data),k=$("<td>").addClass("tele-param-score").html(parseInt(b.attribute_score_normal)+"%");parseInt(b.attribute_score_normal)&&(k.addClass("severe"),h.addClass("severe"));f.append(g).append(h).append(k);c.append(f)}});a.append(b);b.append(c);$(b).mCustomScrollbar()}};
telepath.alerts={sort:"date",dir:!1,data:[],searchString:"",filter:[],init:function(){var a=this,b=$(".tele-panel-alerts");b.empty();this.filter=[];var c=$("<div>").addClass("tele-panel-topbar"),d=$("<div>").addClass("tele-panel-subtitle"),e=$("<div>").addClass("tele-panel-title"),f=$("<div>").addClass("tele-panel-topbar-right");c.append(e).append(f);e.html("Loading Alerts");this.panelTitle=e;b.append(c).append(d).append(telepath.loader);c=$("<div>").radios({title:"Sort By",items:[{id:"date",icon:"time",
tip:"Time"},{id:"count",icon:"bars",tip:"Count"}],selected:this.sort,callback:function(b,c){a.sort==c&&(a.dir=!a.dir);a.sort=c;a.refresh()}});b=$("<div>").teleSearch({callback:function(a,b){telepath.alerts.searchString=b}});$("<a>").addClass("icon-delete-input2").attr("id","remove-button").click(function(){$(".tele-panel-alerts .tele-search-input").val("");telepath.alerts.searchString="";telepath.alerts.refresh()});d.append(b);b=$(".tele-panel-alerts .tele-panel-topbar-right");b.empty();var d=$("<div>").daterange({start:telepath.range.start,
end:telepath.range.end,change:function(a,b){telepath.range.start=a;telepath.range.end=b;telepath.alerts.refresh()}}),g=$("<div>").appSelect({callback:function(a){$(".tele-icon-application",g).removeClass("tele-icon-application").addClass("tele-icon-loader");telepath.alerts.refresh(function(){$(".tele-icon-loader",g).removeClass("tele-icon-loader").addClass("tele-icon-application")})}});b.append(c).append('<div class="tele-navsep"></div>').append(d).append('<div class="tele-navsep"></div>').append(g);
telepath.alerts.refresh();var h;$(".tele-panel-alerts .tele-search-input").keyup("input",function(){clearTimeout(h);$(".tele-panel-alerts .tele-search-input").val()&&(h=setTimeout(function(){telepath.alerts.searchString=$(".tele-panel-alerts .tele-search-input").val();a.input()},1E3))});$("#search-button").on("click",function(b){a.searchString="";$(".tele-panel-alerts .tele-search-input").prop("value",telepath.alerts.searchString);a.input()});telepath.alerts.searchString&&($(".tele-panel-alerts .tele-search-input").prop("value",
telepath.alerts.searchString),a.input())},input:function(){var a=$("#search-button");0<telepath.alerts.searchString.length?a.addClass("icon-delete-input2").removeClass("tele-search-button"):a.removeClass("icon-delete-input2").addClass("tele-search-button");this.refresh()},refresh:function(a){telepath.ds.get("/alerts/index",{sort:this.sort,dir:this.dir,search:this.searchString,filters:this.filter},function(b){telepath.alerts.setData(b.items);a&&"function"==typeof a&&a()})},setData:function(a){telepath.alerts.data=
a;var b=this,c=$(".tele-panel-alerts");this.container=c;$(".tele-alerts-block, .tele-alert-graphs-block, .tele-loader",c).remove();if(0==a.alerts.total)this.panelTitle.html("No Data");else if(this.list=$("<div>").addClass("tele-alerts-block"),this.container.append(this.list),this.list.teleList({data:this.data.alerts.items,searchkey:telepath.alerts.searchString,formatter:function(a){return telepath.alert.rowFormatter(a)},callbacks:{scroll:function(a,c){telepath.ds.get("/alerts/index",{sort:telepath.alerts.sort,
dir:telepath.alerts.dir,search:telepath.alerts.searchString,offset:a,filters:b.filter},function(a){c(a)})}}}),this.panelTitle.html(a.alerts.count+" Sessions"),0!=parseInt(a.alerts.count)){a=$('<div class="tele-alert-graphs-block">').css({marginTop:20});$(c).append(a);var c=$("<div>").addClass("tele-alert-graph-overtime"),d=$("<h2>").html("Alerts over time"),e=$("<div>").addClass("tele-alert-graph-overtime-canvas");c.append(d).append(e);var d=$("<div>").addClass("tele-alert-graph-distribution"),f=
$("<h2>").html("Alert distribution");this.graphDistributionCanvas=$("<div>").addClass("tele-alert-graph-distribution-canvas");var g=$("<div>").attr("id","alert-distribution-showPercent"),h=$("<div>").attr("id","alert-distribution-legend"),k=$("<div>").toggleFlip({left_value:"Type",right_value:"Business Action",flip:function(a){a?($("#alert-distribution-showPercent").empty(),telepath.alerts.show_action_distribution()):($("#alert-distribution-showPercent").empty(),telepath.alerts.show_alert_distribution())}});
d.append(f).append(k).append(g).append(h).append(this.graphDistributionCanvas);a.append(c).append(d);e.flotGraph({data:[{label:"random",data:this.data.time_chart,color:"#FC3D3D"}],options:{legend:{show:!1},series:{lines:{show:!0,fill:!0},points:{show:!0,fillColor:"#fff"}},yaxis:{ticks:5,color:"#D6D6D6",font:{color:"#cccccc",size:11,weight:"bold"}},selection:{mode:"x"},xaxis:{font:{color:"#cccccc",size:11,weight:"bold"},mode:"time",timezone:"browser",timeformat:"%d/%m/%y"},grid:{borderColor:"#D6D6D6",
borderWidth:0,clickable:!0,hoverable:!0,autoHighlight:!0},tooltip:!0,tooltipOpts:{content:"date: %x | alerts: %y"}}});telepath.alerts.show_alert_distribution();$(a).mCustomScrollbar({advanced:{updateOnContentResize:!0},scrollButtons:{enable:!1}});$(window).unbind("resize",b._resize);$(window).bind("resize",b._resize);$(window).trigger("resize")}},show_alert_distribution:function(){function a(a,b,c){c&&(percent=parseFloat(c.series.percent).toFixed(2),$("#alert-distribution-showPercent").html('<span style="font-weight: bold; color: '+
c.series.color+'">'+c.series.label+" ("+percent+"%)</span>"),$(".tele-graph-canvas .flot-overlay").css({cursor:"pointer"}))}function b(a,b,c){c&&(c.series.label&&(e.filter=[],e.filter.push(c.series.label)),e.refresh())}function c(){$(".legend tr").on("click",function(){var a=$(this).children(".legendLabel").text();-1!=$.inArray(a,e.filter)?e.filter.splice($.inArray(a,e.filter),1):e.filter.push(a);e.refresh()})}function d(){$(".legend tr").css({cursor:"pointer"});0<e.filter.length?$.each($(".legend tr"),
function(a,b){-1==$.inArray(b.children[1].innerText,e.filter)&&($(this).children(".legendColorBox").children().html('<div style="width:4px;height:0;border:5px solid #999;overflow:hidden; "></div>'),$(this).css({opacity:"0.5"}))}):$.each(e.data.distribution_chart,function(a,b){e.filter.push(b.label)})}var e=this;this.graphDistributionCanvas.empty();var f=this.data.distribution_chart,g=0;$.each(f,function(a,b){g+=parseInt(b.data)});var h={series:{pie:{show:!0,radius:.5,innerRadius:.4,margin:100,label:{show:!1,
radius:.3,formatter:function(a,b){var c=parseInt(b.data[0][1]),d=parseInt(c/g*100)+"%",e=$("<div>"),f=$("<div>").addClass("tele-pie-label").html(a),d=$("<div>").addClass("tele-pie-percent").html(d).css("color",b.color),c=$("<div>").addClass("tele-pie-count").html(c+" alerts");e.append(f).append(d).append(c);return e.html()}}}},grid:{hoverable:!0,clickable:!0},legend:{show:!0,position:"nw",margin:[50,100],sorted:"ascending"}};setTimeout(function(){telepath.alerts.graphDistributionCanvas.flotGraph({data:f,
options:h});$(".tele-alert-graph-distribution-canvas .tele-graph-canvas").bind("plothover",a);$(".tele-alert-graph-distribution-canvas .tele-graph-canvas").bind("plotclick",b);c();d()},100)},show_action_distribution:function(){function a(a,b,c){c&&(percent=parseFloat(c.series.percent).toFixed(2),$("#alert-distribution-showPercent").html('<span style="font-weight: bold; color: '+c.series.color+'">'+c.series.label+" ("+percent+"%)</span>"),$(".tele-graph-canvas .flot-overlay").css({cursor:"pointer"}))}
function b(a,b,c){c&&(c.series.label&&(that.filter=[],that.filter.push(c.series.label)),that.refresh())}function c(){$(".legend tr").on("click",function(){var a=$(this).children(".legendLabel").text();-1!=$.inArray(a,that.filter)?that.filter.splice($.inArray(a,that.filter),1):that.filter.push(a);that.refresh()})}function d(){$(".legend tr").css({cursor:"pointer"});0<that.filter.length?$.each($(".legend tr"),function(a,b){-1==$.inArray(b.children[1].innerText,that.filter)&&($(this).children(".legendColorBox").children().html('<div style="width:4px;height:0;border:5px solid #999;overflow:hidden; "></div>'),
$(this).css({opacity:"0.5"}))}):$.each(that.data.distribution_chart,function(a,b){that.filter.push(b.label)})}this.graphDistributionCanvas.empty();var e=this.data.action_distribution_chart,f=0;$.each(e,function(a,b){f+=parseInt(b.data)});var g={series:{pie:{show:!0,radius:.5,innerRadius:.4,margin:100,label:{show:!1,radius:.3,formatter:function(a,b){var c=parseInt(b.data[0][1]),d=parseInt(c/f*100)+"%",e=$("<div>"),g=$("<div>").addClass("tele-pie-label").html(a),d=$("<div>").addClass("tele-pie-percent").html(d).css("color",
b.color),c=$("<div>").addClass("tele-pie-count").html(c+" alerts");e.append(g).append(d).append(c);return e.html()}}}},grid:{hoverable:!0,clickable:!0},legend:{show:!0,position:"nw",margin:[50,100],sorted:"ascending"}};setTimeout(function(){telepath.alerts.graphDistributionCanvas.flotGraph({data:e,options:g});$(".tele-alert-graph-distribution-canvas .tele-graph-canvas").bind("plothover",a);$(".tele-alert-graph-distribution-canvas .tele-graph-canvas").bind("plotclick",b);c();d()},100)},_resize:function(){if(0!=
$(".tele-panel-alerts").children().size()){var a=$(window).height(),b=$(window).width()-10;$(".tele-body").css({height:a});var a=a-$(".tele-header").outerHeight()-$(".tele-panel-topbar").outerHeight()-$(".tele-panel-subtitle").outerHeight(),c;c=1200>b?1024>b?300:400:600;$(".tele-panel-alerts .tele-alert-graphs-block",this.list).width(c);$(".tele-panel-alerts .tele-block").width(b-c-15);$(".tele-panel-alerts .tele-block .tele-list").width(b-c-25).height(a-50).mCustomScrollbar("update");$(".tele-panel-alerts .tele-alert-graphs-block").height(a-
50).mCustomScrollbar("update")}}};
telepath.suspects={sort:"date",dir:!1,data:[],total:0,searchString:"",rowFormatter:function(a,b){if("dashboard"==b){var c=""!=a.user?{key:"user",value:a.user}:{key:"IP",value:a.ip_orig};result={raw:a,icon:"suspect",time:a.ts,progbar:!0,itemID:a.sid,progbarBig:a.progbarBig,checkable:a.checkable,checked:a.checked,count:a.count,progbarValue:a.ip_score,time:a.date,details:[{key:"country",value:a.country},{key:"host",value:grabNames(a.host)},c]}}else result={raw:a,icon:"suspect",time:a.ts,progbar:!0,itemID:a.sid,
progbarBig:a.progbarBig,checkable:a.checkable,checked:a.checked,count:a.count,progbarValue:a.ip_score,time:a.date,details:[{key:"country",value:a.country},{key:"IP",value:a.ip_orig},{key:"city",value:a.city},{key:"host",value:grabNames(a.host)},{key:"alerts",value:a.alerts_count},{key:"actions",value:a.actions_count},{key:"cases",value:a.cases_count},{key:"user",value:a.user}]};return result},init:function(){var a=this;this.container=$(".tele-panel-suspects");this.container.empty();this.panelTopBar=
$("<div>").addClass("tele-panel-topbar");this.panelTitle=$("<div>").addClass("tele-panel-title");this.panelTopBar.append(this.panelTitle);this.panelTitle.html("Loading Suspects");this.container.append(this.panelTopBar);this.panelSubBar=$("<div>").addClass("tele-panel-subtitle");this.panelTopBarRight=$("<div>").addClass("tele-panel-topbar-right");this.panelTopBar.append(this.panelTopBarRight);this.container.append(this.panelSubBar);var b=$("<div>").daterange({start:telepath.range.start,end:telepath.range.end,
change:function(a,b){telepath.suspects.refresh(function(){})}}),c=$("<div>").radios({title:"Sort By",items:[{id:"date",icon:"time",tip:"Time"},{id:"count",icon:"bars",tip:"Count"}],selected:this.sort,callback:function(b,c){a.sort==c&&(a.dir=!a.dir);a.sort=c;a.refresh()}});this.panelTopBarRight.append(c).append('<div class="tele-navsep"></div>');var d=$("<div>").appSelect({callback:function(a){$(".tele-icon-application",d).removeClass("tele-icon-application").addClass("tele-icon-loader");telepath.suspects.refresh(function(){$(".tele-icon-loader",
d).removeClass("tele-icon-loader").addClass("tele-icon-application")})}});this.panelTopBarRight.append(b).append('<div class="tele-navsep"></div>').append(d);b=$("<div>").teleSearch({callback:function(a,b){telepath.suspects.searchString=b}});$("<a>").addClass("icon-delete-input2").attr("id","remove-button").click(function(){$(".tele-panel-suspects .tele-search-input").val("");telepath.suspects.searchString="";telepath.suspects.refresh()});this.panelSubBar.append(b);this.refresh();var e;$(".tele-panel-suspects .tele-search-input").keyup("input",
function(){clearTimeout(e);$(".tele-panel-suspects .tele-search-input").val()&&(e=setTimeout(function(){a.searchString=$(".tele-panel-suspects .tele-search-input").val();a.input()},1E3))});$("#search-button").on("click",function(b){a.searchString="";$(".tele-panel-suspects .tele-search-input").prop("value",a.searchString);a.input()});a.searchString&&($(".tele-panel-suspects .tele-search-input").prop("value",a.searchString),a.input())},input:function(){var a=$("#search-button");0<this.searchString.length?
a.addClass("icon-delete-input2").removeClass("tele-search-button"):a.removeClass("icon-delete-input2").addClass("tele-search-button");this.refresh()},refresh:function(a){$(".tele-block, .tele-loader",this.container).remove();this.container.append(telepath.loader);var b=this;telepath.ds.get("/suspects/index",{sort:this.sort,dir:this.dir,search:this.searchString},function(c){b.count=c.count;b.data=c.items;telepath.suspects.loadData();"function"==typeof a&&a()})},_resize:function(){if(0!=$(".tele-panel-suspects").children().size()){var a=
$(window).height();$(".tele-body").css({height:a});a=a-$(".tele-header").outerHeight()-$(".tele-panel-topbar").outerHeight()-$(".tele-panel-subtitle").outerHeight();$(".tele-panel-suspects .tele-block").height(a-20);$(".tele-panel-suspects .tele-block .tele-list").height(a-50);$(".tele-list").mCustomScrollbar("update")}},loadData:function(){var a=this;$(".tele-block, .tele-loader",this.container).remove();this.suspectsList=$("<div>");this.container.append(this.suspectsList);this.suspectsList.teleList({context:"panel",
data:this.data,searchkey:telepath.suspects.searchString,formatter:function(a){return telepath.suspects.rowFormatter(a)},callbacks:{scroll:function(a,c){telepath.ds.get("/suspects/index",{sort:telepath.suspects.sort,dir:telepath.suspects.dir,search:telepath.suspects.searchString,offset:a},function(a){c(a)})}}});this.panelTitle.html(this.count+" Sessions");setTimeout(function(){a._resize()},0);$(window).resize(function(){a._resize()})}};
telepath.reports={init:function(){this.container=$(".tele-panel-reports");this.container.append('<h1 style="padding: 50px; font-size: 24px; font-weight: bold;">Under Construction</h1>')}};
